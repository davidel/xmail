<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>XMail mail server v 1.27</title>
<link rel="stylesheet" href="./xmail.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#LICENSE">LICENSE</a></li>
  <li><a href="#OVERVIEW">OVERVIEW</a></li>
  <li><a href="#VERSION">VERSION</a>
    <ul>
      <li><a href="#current">current</a></li>
      <li><a href="#release-type">release type</a></li>
      <li><a href="#release-date">release date</a></li>
      <li><a href="#project-by">project by</a></li>
      <li><a href="#credits">credits</a></li>
      <li><a href="#warning">warning</a></li>
    </ul>
  </li>
  <li><a href="#DOCUMENTATION-CONVENTIONS">DOCUMENTATION CONVENTIONS</a></li>
  <li><a href="#FEATURES">FEATURES</a></li>
  <li><a href="#PORTING-STATUS">PORTING STATUS</a></li>
  <li><a href="#REQUIREMENTS">REQUIREMENTS</a></li>
  <li><a href="#OBTAINING-THE-SOURCE">OBTAINING THE SOURCE</a></li>
  <li><a href="#BUILD">BUILD</a></li>
  <li><a href="#CONFIGURATION">CONFIGURATION</a>
    <ul>
      <li><a href="#Linux-Solaris-FreeBSD-OpenBSD">Linux/Solaris/FreeBSD/OpenBSD</a></li>
      <li><a href="#NT-Win2K-XP">NT/Win2K/XP</a></li>
      <li><a href="#Environment-variables">Environment variables</a></li>
      <li><a href="#MailRoot-structure">MailRoot structure</a></li>
      <li><a href="#Configuration-tables">Configuration tables</a>
        <ul>
          <li><a href="#ALIASES.TAB">ALIASES.TAB</a></li>
          <li><a href="#ALIASDOMAIN.TAB">ALIASDOMAIN.TAB</a></li>
          <li><a href="#DOMAINS.TAB">DOMAINS.TAB</a></li>
          <li><a href="#DNSROOTS">DNSROOTS</a></li>
          <li><a href="#EXTALIASES.TAB">EXTALIASES.TAB</a></li>
          <li><a href="#MAILUSERS.TAB">MAILUSERS.TAB</a></li>
          <li><a href="#MESSAGE.ID">MESSAGE.ID</a></li>
          <li><a href="#POP3LINKS.TAB">POP3LINKS.TAB</a></li>
          <li><a href="#SERVER.TAB">SERVER.TAB</a></li>
          <li><a href="#SMTPGW.TAB">SMTPGW.TAB</a></li>
          <li><a href="#SMTPFWD.TAB">SMTPFWD.TAB</a></li>
          <li><a href="#SMTPRELAY.TAB">SMTPRELAY.TAB</a></li>
          <li><a href="#SMTPAUTH.TAB">SMTPAUTH.TAB</a></li>
          <li><a href="#SMTPEXTAUTH.TAB">SMTPEXTAUTH.TAB</a></li>
          <li><a href="#USERDEF.TAB">USERDEF.TAB</a></li>
          <li><a href="#CTRLACCOUNTS.TAB">CTRLACCOUNTS.TAB</a></li>
          <li><a href="#SPAMMERS.TAB">SPAMMERS.TAB</a></li>
          <li><a href="#SPAM-ADDRESS.TAB">SPAM-ADDRESS.TAB</a></li>
          <li><a href="#POP3.IPMAP.TAB">POP3.IPMAP.TAB</a></li>
          <li><a href="#SMTP.IPMAP.TAB">SMTP.IPMAP.TAB</a></li>
          <li><a href="#CTRL.IPMAP.TAB">CTRL.IPMAP.TAB</a></li>
          <li><a href="#FINGER.IPMAP.TAB">FINGER.IPMAP.TAB</a></li>
          <li><a href="#USER.TAB">USER.TAB</a></li>
          <li><a href="#MLUSERS.TAB">MLUSERS.TAB</a></li>
          <li><a href="#MAILPROC.TAB">MAILPROC.TAB</a></li>
          <li><a href="#SMTP.IPPROP.TAB">SMTP.IPPROP.TAB</a></li>
          <li><a href="#SMTP.HNPROP.TAB">SMTP.HNPROP.TAB</a></li>
          <li><a href="#FILTERS.IN.TAB">FILTERS.IN.TAB</a></li>
          <li><a href="#FILTERS.OUT.TAB">FILTERS.OUT.TAB</a></li>
          <li><a href="#FILTERS.POST-RCPT.TAB">FILTERS.POST-RCPT.TAB</a></li>
          <li><a href="#FILTERS.PRE-DATA.TAB">FILTERS.PRE-DATA.TAB</a></li>
          <li><a href="#FILTERS.POST-DATA.TAB">FILTERS.POST-DATA.TAB</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a></li>
  <li><a href="#EXTERNAL-AUTHENTICATION">EXTERNAL AUTHENTICATION</a></li>
  <li><a href="#SMTP-CLIENT-AUTHENTICATION">SMTP CLIENT AUTHENTICATION</a></li>
  <li><a href="#CUSTOM-DOMAIN-MAIL-PROCESSING">CUSTOM DOMAIN MAIL PROCESSING</a></li>
  <li><a href="#CMD-ALIASES">CMD ALIASES</a></li>
  <li><a href="#SERVER.TAB-VARIABLES">SERVER.TAB VARIABLES</a></li>
  <li><a href="#MESSAGE-FILTERS">MESSAGE FILTERS</a></li>
  <li><a href="#SMTP-MESSAGE-FILTERS">SMTP MESSAGE FILTERS</a></li>
  <li><a href="#USER.TAB-VARIABLES">USER.TAB VARIABLES</a></li>
  <li><a href="#MAIL-ROUTING-THROUGH-ADDRESSES">MAIL ROUTING THROUGH ADDRESSES</a></li>
  <li><a href="#XMAIL-SPOOL-DESIGN">XMAIL SPOOL DESIGN</a></li>
  <li><a href="#SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</a></li>
  <li><a href="#SSL-CONFIGURATION">SSL CONFIGURATION</a></li>
  <li><a href="#SMTP-COMMANDS">SMTP COMMANDS</a></li>
  <li><a href="#POP3-COMMANDS">POP3 COMMANDS</a></li>
  <li><a href="#COMMAND-LINE">COMMAND LINE</a></li>
  <li><a href="#XMAIL-ADMIN-PROTOCOL">XMAIL ADMIN PROTOCOL</a>
    <ul>
      <li><a href="#Description1">Description</a></li>
      <li><a href="#Adding-a-user1">Adding a user</a></li>
      <li><a href="#Deleting-a-user1">Deleting a user</a></li>
      <li><a href="#Changing-a-users-password1">Changing a user&#39;s password</a></li>
      <li><a href="#Authenticate-user1">Authenticate user</a></li>
      <li><a href="#Retrieve-user-statistics1">Retrieve user statistics</a></li>
      <li><a href="#Adding-an-alias1">Adding an alias</a></li>
      <li><a href="#Deleting-an-alias1">Deleting an alias</a></li>
      <li><a href="#Listing-aliases1">Listing aliases</a></li>
      <li><a href="#Adding-an-external-alias">Adding an external alias</a></li>
      <li><a href="#Deleting-an-external-alias">Deleting an external alias</a></li>
      <li><a href="#Listing-external-aliases">Listing external aliases</a></li>
      <li><a href="#Listing-user-vars1">Listing user vars</a></li>
      <li><a href="#Setting-user-vars1">Setting user vars</a></li>
      <li><a href="#Listing-users1">Listing users</a></li>
      <li><a href="#Getting-mailproc.tab-file1">Getting mailproc.tab file</a></li>
      <li><a href="#Setting-mailproc.tab-file1">Setting mailproc.tab file</a></li>
      <li><a href="#Adding-a-mailing-list-user1">Adding a mailing list user</a></li>
      <li><a href="#Deleting-a-mailing-list-user1">Deleting a mailing list user</a></li>
      <li><a href="#Listing-mailing-list-users1">Listing mailing list users</a></li>
      <li><a href="#Adding-a-domain1">Adding a domain</a></li>
      <li><a href="#Deleting-a-domain1">Deleting a domain</a></li>
      <li><a href="#Listing-handled-domains1">Listing handled domains</a></li>
      <li><a href="#Adding-a-domain-alias1">Adding a domain alias</a></li>
      <li><a href="#Deleting-a-domain-alias1">Deleting a domain alias</a></li>
      <li><a href="#Listing-alias-domains1">Listing alias domains</a></li>
      <li><a href="#Getting-custom-domain-file1">Getting custom domain file</a></li>
      <li><a href="#Setting-custom-domain-file1">Setting custom domain file</a></li>
      <li><a href="#Listing-custom-domains1">Listing custom domains</a></li>
      <li><a href="#Adding-a-POP3-external-link1">Adding a POP3 external link</a></li>
      <li><a href="#Deleting-a-POP3-external-link1">Deleting a POP3 external link</a></li>
      <li><a href="#Listing-POP3-external-links1">Listing POP3 external links</a></li>
      <li><a href="#Enabling-a-POP3-external-link1">Enabling a POP3 external link</a></li>
      <li><a href="#Listing-files1">Listing files</a></li>
      <li><a href="#Getting-configuration-file1">Getting configuration file</a></li>
      <li><a href="#Setting-configuration-file1">Setting configuration file</a></li>
      <li><a href="#Listing-frozen-messages1">Listing frozen messages</a></li>
      <li><a href="#Rescheduling-frozen-message1">Rescheduling frozen message</a></li>
      <li><a href="#Deleting-frozen-message1">Deleting frozen message</a></li>
      <li><a href="#Getting-frozen-message-log-file1">Getting frozen message log file</a></li>
      <li><a href="#Getting-frozen-message1">Getting frozen message</a></li>
      <li><a href="#Starting-a-queue-flush1">Starting a queue flush</a></li>
      <li><a href="#Do-nothing-command1">Do nothing command</a></li>
      <li><a href="#Quit-the-connection1">Quit the connection</a></li>
      <li><a href="#Do-you-want1">Do you want...?</a></li>
    </ul>
  </li>
  <li><a href="#XMAIL-LOCAL-MAILER">XMAIL LOCAL MAILER</a></li>
  <li><a href="#CtrlClnt-XMAIL-ADMINISTRATION">CtrlClnt (XMAIL ADMINISTRATION)</a></li>
  <li><a href="#SERVER-SHUTDOWN">SERVER SHUTDOWN</a></li>
  <li><a href="#MkUsers">MkUsers</a></li>
  <li><a href="#sendmail">sendmail</a></li>
  <li><a href="#MISCELLANEOUS">MISCELLANEOUS</a></li>
  <li><a href="#THANKS">THANKS</a></li>
  <li><a href="#POD-ERRORS">POD ERRORS</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>XMail - Internet/Intranet mail server.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="LICENSE">LICENSE</h1>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation (<a href="http://www.gnu.org">http://www.gnu.org</a>); either version 2 of the License, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="OVERVIEW">OVERVIEW</h1>

<p>XMail is an Internet and Intranet mail server featuring an SMTP server, POP3 server, finger server, multiple domains, no need for users to have a real system account, SMTP relay checking, RBL/RSS/ORBS/DUL and custom (IP based and address based) spam protection, SMTP authentication (PLAIN LOGIN CRAM-MD5 POP3-before-SMTP and custom), a POP3 account synchronizer with external POP3 accounts, account aliases, domain aliases, custom mail processing, direct mail files delivery, custom mail filters, mailing lists, remote administration, custom mail exchangers, logging, and multi-platform code.</p>

<p>XMail sources compile under GNU/Linux, FreeBSD, OpenBSD, NetBSD, OSX, Solaris and NT/2K.</p>

<p>This server was born due to the need of having a free and stable Mail Server to be used inside my old company, which used a Windows Network. I don&#39;t like to reinvent the wheel but the need of some special features drive me to start a new project. Probably if I could use a Linux server on my net, I would be able to satisfy my needs without writing code, but this is not the case. It should be also portable to other OSs, like Linux and other Unixes.</p>

<p>Another reason that drove me to write XMail is the presence of the same steps in setting up a typical mail server, i.e.:</p>

<pre><code> sendmail + qpopper + fetchmail</code></pre>

<p>if one needs SMTP, POP3 and external synchronization, or:</p>

<pre><code> sendmail + qpopper</code></pre>

<p>for only SMTP and POP3 (I&#39;ve quoted sendmail, qpopper and fetchmail, but there are many other packages you can use to reach these needs). With XMail you get an all-in-one package with a central administration that can simplify the above common steps.</p>

<p>The first code of XMail Server is started on Windows NT and Linux, and now, the FreeBSD and Solaris version ready. The compilers supported are gcc for Linux, FreeBSD, OpenBSD and Solaris and M$ Visual C++ for NT/2K.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="VERSION">VERSION</h1>

<h2 id="current">current</h2>

<p>1.27</p>

<h2 id="release-type">release type</h2>

<p>Gnu Public License <a href="http://www.gnu.org">http://www.gnu.org</a></p>

<h2 id="release-date">release date</h2>

<p>Feb 25, 2010</p>

<h2 id="project-by">project by</h2>

<p>Davide Libenzi &lt;davidel@xmailserver.org&gt; <a href="http://www.xmailserver.org/">http://www.xmailserver.org/</a></p>

<h2 id="credits">credits</h2>

<p>Michael Hartle &lt;mhartle@hartle-klug.com&gt;</p>

<p>Shawn Anderson &lt;sanderson@eye-catcher.com&gt;</p>

<p>Dick van der Kaaden &lt;dick@netrex.nl&gt;</p>

<p>Beau E, Cox &lt;beau@beaucox.com&gt;</p>

<h2 id="warning">warning</h2>

<pre><code> ************************************************************
 *                     &lt;&lt;WARNING&gt;&gt;                          *
 *  If you&#39;re upgrading an existing version of XMail it&#39;s   *
 *  strongly suggested that you read all the ChangeLog      *
 *  notes that range from existing version to the new one.  *
 ************************************************************</code></pre>

<p>See the <a href="./ChangeLog.html"><b>Change Log</b></a>.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="DOCUMENTATION-CONVENTIONS">DOCUMENTATION CONVENTIONS</h1>

<p>This document contains various examples of entries you must make to the XMail configuration tables. These examples are written in a</p>

<pre><code> mono-spaced font like this.</code></pre>

<p>The prototype statement is shown with explicit &#39;<b>[TAB]</b>&#39; and &#39;<b>[NEWLINE]</b>&#39; characters:</p>

<pre><code> &quot;aliasdomain&quot;[TAB]&quot;realdomain&quot;[NEWLINE]</code></pre>

<p>while examples omit these characters:</p>

<pre><code> &quot;simpson.org&quot;   &quot;simpson.com&quot;
 &quot;*.homer.net&quot;   &quot;homer.net&quot;</code></pre>

<p>&#39;<b>YOU MUST ALWAYS ENTER THE DATA EXACTLY AS SHOWN IN THE PROTOTYPE.</b>&#39;</p>

<p>When a prototype or example statement is too long to be easily shown on the screen or printed, the line is split into multiple lines by showing &#39;<b>=</b>&gt;&#39; at the end of continued lines and indenting the continuation line(s):</p>

<pre><code> &quot;domain&quot;[TAB]&quot;account&quot;[TAB]&quot;enc-passwd&quot;[TAB]&quot;account-id&quot;[TAB]&quot;account-dir&quot;[TAB]=&gt;
   &quot;account-type&quot;[NEWLINE]</code></pre>

<p>&#39;<b>DO NOT ENTER THE =&gt; CHARACTERS. ENTER THE ENTIRE ENTRY AS ONE LINE.</b>&#39;</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="FEATURES">FEATURES</h1>

<ul>

<li><p>ESMTP/ESMTPS server</p>

</li>
<li><p>POP3/POP3S server</p>

</li>
<li><p>Finger server</p>

</li>
<li><p>Multiple domains</p>

</li>
<li><p>Users don&#39;t need a real system account</p>

</li>
<li><p>SMTP relay checking</p>

</li>
<li><p>Custom SMTP maps check</p>

</li>
<li><p>SMTP protection over spammers (IP based and address based)</p>

</li>
<li><p>SMTP authentication (PLAIN LOGIN CRAM-MD5 POP3/SMTP and custom)</p>

</li>
<li><p>SMTP ETRN command support</p>

</li>
<li><p>POP3 account synchronizer with external POP3 accounts</p>

</li>
<li><p>Account aliasing</p>

</li>
<li><p>Domain aliasing</p>

</li>
<li><p>Mailing lists</p>

</li>
<li><p>Custom mail processing</p>

</li>
<li><p>Locally generated mail files delivery</p>

</li>
<li><p>Remote administration</p>

</li>
<li><p>Custom mail exchangers</p>

</li>
<li><p>Logging</p>

</li>
<li><p>Multi platform (any Windows and almost any Unix OSs)</p>

</li>
<li><p>Fine grained message filters</p>

</li>
<li><p>Custom (external) POP3/SMTP authentication</p>

</li>
<li><p>TLS support for SMTP and POP3, both server and client side</p>

</li>
</ul>

<p>[<a href="#index__">top</a>]</p>

<h1 id="PORTING-STATUS">PORTING STATUS</h1>

<p>Right now the Linux and NT ports are stable, while the Solaris, FreeBSD, OpenBSD and OSX ones have not been tested as well as the previous OSs.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="REQUIREMENTS">REQUIREMENTS</h1>

<ul>

<li><p>Any version of Linux that has glibc.</p>

</li>
<li><p>Windows NT with ws2_32.dll correctly installed.</p>

</li>
<li><p>A working DNS and gateway to the Internet (if you plan to use it).</p>

</li>
<li><p>To build from source for Linux you need any version of gcc and glibc installed.</p>

</li>
<li><p>To build from source for Windows you need MS Visual C++ (makefile included).</p>

</li>
<li><p>-or- any other working compiler that provides support for the Win32 SDK.</p>

</li>
</ul>

<p>[<a href="#index__">top</a>]</p>

<h1 id="OBTAINING-THE-SOURCE">OBTAINING THE SOURCE</h1>

<p>Always get the latest sources at the XMail home page <a href="http://www.xmailserver.org/">http://www.xmailserver.org/</a> because otherwise you may be using an old version.</p>

<p>Use the correct distribution for your system and don&#39;t mix Unix files with Windows ones because this is one of the most common cause of XMail bad behavior.</p>

<p>When you unzip (or untar) the package you&#39;ve to check that the MailRoot directory contained inside the package itself is complete (look at the directory tree listed below) because some unzippers don&#39;t restore empty directories.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="BUILD">BUILD</h1>

<p>XMail depends on OpenSSL to provide SSL support, so the development package of OpenSSL (in Debian called libssl-dev) must be installed on your system. For Windows, the XMail source already contains a pre-built version of the OpenSSL libraries, include files, and executable. The OpenSSL web site can be found here <a href="http://www.openssl.org">http://www.openssl.org</a>.</p>

<p>[Windows]</p>

<pre><code>  You have to have the command line environment setup before (usually the vcvars64.bat
  script inside the Visual C++ directory).

  C:&gt; nmake /f Makefile.win

  If once you run the XMail binaries, Windows complains about missing DLLs, your system
  is probably missing the Microsoft CRT redistributable package, that you can download
  here L&lt;http://www.xmailserver.org/vcredist_x86.exe&gt;.</code></pre>

<p>[Linux]</p>

<pre><code>  # make -f Makefile.lnx</code></pre>

<p>[FreeBSD]</p>

<pre><code>  # setenv OSTYPE FreeBSD
  # gmake -f Makefile.bsd</code></pre>

<p>or (depending on the shell):</p>

<pre><code>  # OSTYPE=FreeBSD gmake -f Makefile.bsd</code></pre>

<p>[OpenBSD]</p>

<pre><code>  # setenv OSTYPE OpenBSD
  # gmake -f Makefile.bsd</code></pre>

<p>or (depending on the shell):</p>

<pre><code>  # OSTYPE=OpenBSD gmake -f Makefile.bsd</code></pre>

<p>[NetBSD]</p>

<pre><code>  # setenv OSTYPE NetBSD
  # gmake -f Makefile.bsd</code></pre>

<p>or (depending on the shell):</p>

<pre><code>  # OSTYPE=NetBSD gmake -f Makefile.bsd</code></pre>

<p>[OSX]</p>

<pre><code>  # OSTYPE=Darwin make -f Makefile.bsd</code></pre>

<p>or (depending on the shell):</p>

<pre><code>  # setenv OSTYPE Darwin
  # make -f Makefile.bsd</code></pre>

<p>[Solaris]</p>

<pre><code>  # make -f Makefile.sso</code></pre>

<p>Under Linux an init.d startup script is supplied (xmail) to allow you to run XMail as a standard rc? daemon. You must put it into /etc/init.d (it depends on which distro you&#39;re using) directory and then create K??xmail - S??xmail links into the proper directories.</p>

<p>Under Windows NT/2000/XP the XMail&#39;s executable is a Win32 service by default and if you want to have it built like a standard executable you&#39;ve to comment the statement:</p>

<pre><code> &quot;#define SERVICE&quot; in MainWin.cpp</code></pre>

<p>When it&#39;s built as a service (default) you can run:</p>

<pre><code> XMail --install</code></pre>

<p>to install XMail as a manual startup service or:</p>

<pre><code> XMail --install-auto</code></pre>

<p>to install XMail as an automatic startup service.</p>

<p>If you run &#39;<b>--install</b>&#39; and you want XMail to run at NT boot, you must go in ControlPanel-&gt;Services and edit the startup options of XMail. Once you have the service version of XMail you can run it in a &#39;normal&#39; way by executing:</p>

<pre><code> XMail --debug [options]</code></pre>

<p>[<a href="#index__">top</a>]</p>

<h1 id="CONFIGURATION">CONFIGURATION</h1>

<h2 id="Linux-Solaris-FreeBSD-OpenBSD">Linux/Solaris/FreeBSD/OpenBSD</h2>

<ol>

<li><p>Build XMail.</p>

</li>
<li><p>Log as root.</p>

</li>
<li><p>Copy the supplied MailRoot directory where you want it to reside (normally /var).</p>

</li>
<li><p>Do a # chmod 700 /var/MailRoot to setup MailRoot directory access rights.</p>

</li>
<li><p>Strip XMail executables if you want to reduce their sizes (strip filename).</p>

</li>
<li><p>Copy XMail executables to /var/MailRoot/bin.</p>

</li>
<li><p>Optionally, you can setup a dedicated temporary files directory for XMail, by setting the environment variable XMAIL_TEMP, which defaults to /tmp/. XMail uses such directory when it has to create files that must be accessible to external programs like filters.</p>

</li>
<li><p>If you have &#39;<b>inetd</b>&#39; installed, comment out the lines of &#39;<b>/etc/inetd.conf</b>&#39; that involve SMTP, POP3, and Finger. Restart &#39;<b>inetd</b>&#39; (kill -HUP ...).</p>

</li>
<li><p>Since XMail uses syslog to log messages, enable syslogd if it&#39;s not running.</p>

</li>
<li><p>Setup the &#39;<b>SERVER.TAB</b>&#39; configuration file (after reading the rest of this document well).</p>

</li>
<li><p>Add your users and domains (after reading the rest of this document well).</p>

</li>
<li><p>Change or comment out (#) the example account in &#39;<b>ctrlaccounts.tab</b>&#39; by using a non-trivial username and password.</p>

</li>
<li><p>Copy the xmail startup script to your init.d directory (it&#39;s position depends on your distro). If you&#39;ve setup XMail to work in a subdirectory other than &#39;<b>/var/MailRoot</b>&#39; you must edit the xmail startup script to customize its boot parameters.</p>

</li>
<li><p>Use the &#39;<b>sysv_inst.sh</b>&#39; shell script (from root user) to create SysV boot script - unless your distro has other tools to do this.</p>

</li>
<li><p>To start XMail without reboot you can run (from root): /etc/rc.d/init.d/xmail start otherwise reboot your machine.</p>

</li>
<li><p>Setup the file &#39;<b>smtprelay.tab</b>&#39; if you want to extend mail relaying to IPs outside of the internet&#39;s private IP blocks (or you want to deny even those - that comes enabled by default with XMail).</p>

</li>
<li><p>Look at [<a href="#SSL-CONFIGURATION">SSL CONFIGURATION</a>] for information about how to create the required &#39;<b>server.key</b>&#39; and &#39;<b>server.cert</b>&#39; files.</p>

</li>
</ol>

<p>For further configuration options, please see the [<a href="#COMMAND-LINE">COMMAND LINE</a>] section.</p>

<p>[<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h2 id="NT-Win2K-XP">NT/Win2K/XP</h2>

<ol>

<li><p>Build XMail.</p>

</li>
<li><p>Copy the supplied MailRoot directory where you want it to reside (normally &#39;<b>C:\MailRoot</b>&#39;).</p>

</li>
<li><p>Setup the MailRoot directory (and subdirectories and file) permissions to allow access only to System and Administrators. Doing this you can run XMail as a console startup only if you&#39;re Administrator (service startup as System).</p>

</li>
<li><p>Copy XMail executables to &#39;<b>C:\MailRoot\bin</b>&#39;.</p>

</li>
<li><p>With &#39;<b>regedit</b>&#39;, create &#39;<b>GNU</b>&#39; key inside &#39;<b>HKEY_LOCAL_MACHINE\SOFTWARE\</b>&#39; and then &#39;<b>XMail</b>&#39; key inside &#39;<b>HKEY_LOCAL_MACHINE\SOFTWARE\GNU</b>&#39;. Note: If you are using a 32bit binary with a 64bit Windows, replace &#39;<b>HKEY_LOCAL_MACHINE\SOFTWARE\</b>&#39; with &#39;<b>HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\</b>&#39; here, and in the points below.</p>

</li>
<li><p>Create a new string value named &#39;<b>MAIL_ROOT</b>&#39; inside &#39;<b>HKEY_LOCAL_MACHINE\SOFTWARE\GNU\XMail\</b>&#39; with value &#39;<b>C:\MailRoot</b>&#39;.</p>

</li>
<li><p>Optionally create a new string value named &#39;<b>MAIL_CMD_LINE</b>&#39; inside &#39;<b>HKEY_LOCAL_MACHINE\SOFTWARE\GNU\XMail\</b>&#39; to store your command line options (read well the rest of this document).</p>

</li>
<li><p>Open an NT console (command prompt).</p>

</li>
<li><p>Go inside &#39;<b>C:\MailRoot\bin</b>&#39; and run: XMail --install for a manual startup, or: XMail --install-auto for an automatic startup.</p>

</li>
<li><p>If you have other services that provide the same functionality as XMail, that is SMTP, POP3, or Finger servers, you must stop these services.</p>

</li>
<li><p>Setup the &#39;<b>SERVER.TAB</b>&#39; configuration option after reading the rest of this document well.</p>

</li>
<li><p>Add your users and domains (after reading to the rest of this document well).</p>

</li>
<li><p>Setup file permissions of the &#39;<b>C:\MailRoot</b>&#39; directory to grant access only to &#39;<b>SYSTEM</b>&#39; and &#39;<b>Domain Admins</b>&#39;.</p>

</li>
<li><p>Change or comment out (#) the example account in ctrlaccounts.tab by using a non-trivial username and password.</p>

</li>
<li><p>To start XMail without reboot you can go to: ControlPanel -&gt; Services -&gt; XMail server and start the service, otherwise reboot your machine.</p>

</li>
<li><p>Setup the file &#39;<b>smtprelay.tab</b>&#39; if you want to extend mail relaying to IPs outside of the internet&#39;s private IP blocks (or you want to deny even those - that comes enabled by default with XMail).</p>

</li>
<li><p>Look at [<a href="#SSL-CONFIGURATION">SSL CONFIGURATION</a>] for information about how to create the required &#39;<b>server.key</b>&#39; and &#39;<b>server.cert</b>&#39; files.</p>

</li>
</ol>

<p>For further configuration options, please see the [<a href="#COMMAND-LINE">COMMAND LINE</a>] section.</p>

<p>[<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h2 id="Environment-variables">Environment variables</h2>

<dl>

<dt id="MAIL_ROOT">[MAIL_ROOT]</dt>
<dd>

<p>If you want to start XMail as a simple test you must setup an environment variable MAIL_ROOT that points to the XMail Server root directory.</p>

<p>Linux/etc.:</p>

<pre><code> export MAIL_ROOT=/var/XMailRoot</code></pre>

<p>Windows:</p>

<pre><code> set MAIL_ROOT=C:\MailRoot</code></pre>

</dd>
<dt id="MAIL_CMD_LINE">[MAIL_CMD_LINE]</dt>
<dd>

<p>Allows the user to specify extra command line parameters (they will be appended to the ones specified in the command line).</p>

</dd>
<dt id="XMAIL_PID_DIR">[XMAIL_PID_DIR]</dt>
<dd>

<p>Allows the user to specify the PID directory (Unix only ports). The specified directory must NOT have the final slash (/) appended to the path.</p>

</dd>
</dl>

<p>[<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h2 id="MailRoot-structure">MailRoot structure</h2>

<p>Mail root directory contain these files:</p>

<pre><code>  aliases.tab &lt;file&gt;
  aliasdomain.tab &lt;file&gt;
  domains.tab &lt;file&gt;
  dnsroots    &lt;file&gt;
  extaliases.tab  &lt;file&gt;
  mailusers.tab   &lt;file&gt;
  message.id  &lt;file&gt;
  pop3links.tab   &lt;file&gt;
  server.tab  &lt;file&gt;
  server.cert &lt;file&gt;
  server.key &lt;file&gt;
  smtpgw.tab  &lt;file&gt;
  smtpfwd.tab &lt;file&gt;
  smtprelay.tab   &lt;file&gt;
  smtpauth.tab    &lt;file&gt;
  smtpextauth.tab &lt;file&gt;
  userdef.tab &lt;file&gt;
  ctrlaccounts.tab    &lt;file&gt;
  spammers.tab    &lt;file&gt;
  spam-address.tab    &lt;file&gt;
  pop3.ipmap.tab  &lt;file&gt;
  smtp.ipmap.tab  &lt;file&gt;
  ctrl.ipmap.tab  &lt;file&gt;
  finger.ipmap.tab    &lt;file&gt;
  filters.in.tab  &lt;file&gt;
  filters.out.tab &lt;file&gt;
  filters.post-rcpt.tab &lt;file&gt;
  filters.pre-data.tab &lt;file&gt;
  filters.post-data.tab &lt;file&gt;
  smtp.ipprop.tab &lt;file&gt;
  smtp.hnprop.tab &lt;file&gt;</code></pre>

<p>and these directories:</p>

<pre><code>  bin     &lt;dir&gt;
  cmdaliases  &lt;dir&gt;
  tabindex    &lt;dir&gt;
  dnscache    &lt;dir&gt;
    mx  &lt;dir&gt;
    ns  &lt;dir&gt;
  custdomains &lt;dir&gt;
  filters     &lt;dir&gt;
  logs        &lt;dir&gt;
  pop3locks   &lt;dir&gt;
  pop3linklocks   &lt;dir&gt;
  pop3links   &lt;dir&gt;
  spool       &lt;dir&gt;
    local       &lt;dir&gt;
    temp        &lt;dir&gt;
    0           &lt;dir&gt;
      0           &lt;dir&gt;
        mess        &lt;dir&gt;
        rsnd        &lt;dir&gt;
        info        &lt;dir&gt;
        temp        &lt;dir&gt;
        slog        &lt;dir&gt;
        lock        &lt;dir&gt;
        mprc        &lt;dir&gt;
        froz        &lt;dir&gt;
      ...
    ...
  userauth    &lt;dir&gt;
    pop3    &lt;dir&gt;
    smtp    &lt;dir&gt;
  domains     &lt;dir&gt;
  msgsync     &lt;dir&gt;</code></pre>

<p>and for each domain DOMAIN handled a directory (inside <b>domains</b>):</p>

<pre><code>    DOMAIN      &lt;dir&gt;
    userdef.tab &lt;file&gt;
    mailproc.tab    &lt;file&gt;  [ optional ]</code></pre>

<p>inside of which reside, for each account ACCOUNT:</p>

<pre><code>      ACCOUNT         &lt;dir&gt;
        user.tab    &lt;file&gt;
        mlusers.tab &lt;file&gt;  [ mailing list case ]
        mailproc.tab    &lt;file&gt;  [ optional ]
        pop3.ipmap.tab  &lt;file&gt;  [ optional ]</code></pre>

<p>and</p>

<pre><code>        mailbox     &lt;dir&gt;</code></pre>

<p>for mailbox structure, while:</p>

<pre><code>        Maildir     &lt;dir&gt;
          tmp &lt;dir&gt;
          new &lt;dir&gt;
          cur &lt;dir&gt;</code></pre>

<p>for Maildir structure. The <b>msgsync</b> directory is used to store UIDL lists for PSYNC accounts that require leaving messages on the server. Inside the <b>msgsync</b> other directories will be created with the name of the remote server, directories that will store UIDL DB files.</p>

<p>[<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h2 id="Configuration-tables">Configuration tables</h2>

<p>TAB (&#39;<b>something.tab</b>&#39;) files are text files (in the sense meant by the OS in use: &lt;CR&gt;&lt;LF&gt; for NT and &lt;CR&gt; for Linux) with this format:</p>

<pre><code> &quot;value1&quot;[TAB]&quot;value2&quot;[TAB]...[NEWLINE]</code></pre>

<p>The following sections explain each file&#39;s structure and use.</p>

<dl>

<dt id="ALIASES.TAB-file"><a href="#ALIASES.TAB">&quot;ALIASES.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="ALIASDOMAIN.TAB-file"><a href="#ALIASDOMAIN.TAB">&quot;ALIASDOMAIN.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="DOMAINS.TAB-file"><a href="#DOMAINS.TAB">&quot;DOMAINS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="DNSROOTS-file"><a href="#DNSROOTS">&quot;DNSROOTS file&quot;</a></dt>
<dd>

</dd>
<dt id="EXTALIASES.TAB-file"><a href="#EXTALIASES.TAB">&quot;EXTALIASES.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="MAILUSERS.TAB-file"><a href="#MAILUSERS.TAB">&quot;MAILUSERS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="MESSAGE.ID-file"><a href="#MESSAGE.ID">&quot;MESSAGE.ID file&quot;</a></dt>
<dd>

</dd>
<dt id="POP3LINKS.TAB-file"><a href="#POP3LINKS.TAB">&quot;POP3LINKS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SERVER.TAB-file"><a href="#SERVER.TAB">&quot;SERVER.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTPGW.TAB-file"><a href="#SMTPGW.TAB">&quot;SMTPGW.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTPFWD.TAB-file"><a href="#SMTPFWD.TAB">&quot;SMTPFWD.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTPRELAY.TAB-file"><a href="#SMTPRELAY.TAB">&quot;SMTPRELAY.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTPAUTH.TAB-file"><a href="#SMTPAUTH.TAB">&quot;SMTPAUTH.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTPEXTAUTH.TAB-file"><a href="#SMTPEXTAUTH.TAB">&quot;SMTPEXTAUTH.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="USERDEF.TAB-file"><a href="#USERDEF.TAB">&quot;USERDEF.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="CTRLACCOUNTS.TAB-file"><a href="#CTRLACCOUNTS.TAB">&quot;CTRLACCOUNTS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SPAMMERS.TAB-file"><a href="#SPAMMERS.TAB">&quot;SPAMMERS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SPAM-ADDRESS.TAB-file"><a href="#SPAM-ADDRESS.TAB">&quot;SPAM-ADDRESS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="POP3.IPMAP.TAB-file"><a href="#POP3.IPMAP.TAB">&quot;POP3.IPMAP.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTP.IPMAP.TAB-file"><a href="#SMTP.IPMAP.TAB">&quot;SMTP.IPMAP.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="CTRL.IPMAP.TAB-file"><a href="#CTRL.IPMAP.TAB">&quot;CTRL.IPMAP.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="FINGER.IPMAP.TAB-file"><a href="#FINGER.IPMAP.TAB">&quot;FINGER.IPMAP.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="USER.TAB-file"><a href="#USER.TAB">&quot;USER.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="MLUSERS.TAB-file"><a href="#MLUSERS.TAB">&quot;MLUSERS.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="MAILPROC.TAB-file"><a href="#MAILPROC.TAB">&quot;MAILPROC.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTP.IPPROP.TAB-file"><a href="#SMTP.IPPROP.TAB">&quot;SMTP.IPPROP.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="SMTP.HNPROP.TAB-file"><a href="#SMTP.HNPROP.TAB">&quot;SMTP.HNPROP.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="FILTERS.IN.TAB-file"><a href="#FILTERS.IN.TAB">&quot;FILTERS.IN.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="FILTERS.OUT.TAB-file"><a href="#FILTERS.OUT.TAB">&quot;FILTERS.OUT.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="FILTERS.POST-RCPT.TAB-file"><a href="#FILTERS.POST-RCPT.TAB">&quot;FILTERS.POST-RCPT.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="FILTERS.PRE-DATA.TAB-file"><a href="#FILTERS.PRE-DATA.TAB">&quot;FILTERS.PRE-DATA.TAB file&quot;</a></dt>
<dd>

</dd>
<dt id="FILTERS.POST-DATA.TAB-file"><a href="#FILTERS.POST-DATA.TAB">&quot;FILTERS.POST-DATA.TAB file&quot;</a></dt>
<dd>

</dd>
</dl>

<p>[<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="ALIASES.TAB">ALIASES.TAB</h3>

<pre><code> &quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;realaccount&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;home.bogus&quot;    &quot;davidel&quot;   &quot;dlibenzi&quot;</code></pre>

<p>define &#39;davidel&#39; as alias for &#39;dlibenzi&#39; in &#39;home.bogus&#39; domain.</p>

<pre><code> &quot;home.bogus&quot;    &quot;foo*bog&quot;   &quot;homer@internal-domain.org&quot;</code></pre>

<p>define an alias for all users whose name starts with &#39;<b>foo</b>&#39; and ends with &#39;<b>bog</b>&#39; that points to the locally handled account &#39;<b>homer@internal-domain.org</b>&#39;.</p>

<pre><code> &quot;home.bogus&quot;    &quot;??trips&quot;   &quot;travels&quot;</code></pre>

<p>define an alias for all users whose names start with any two chars and end with &#39;<b>trips</b>&#39;. You can even have wildcards in the domain field, as:</p>

<pre><code> &quot;*&quot; &quot;postmaster&quot;    &quot;postmaster@domain.net&quot;</code></pre>

<p>You &#39;<b>CANNOT</b>&#39; edit this file while XMail is running because it is an indexed file.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="ALIASDOMAIN.TAB">ALIASDOMAIN.TAB</h3>

<pre><code> &quot;aliasdomain&quot;[TAB]&quot;realdomain&quot;[NEWLINE]</code></pre>

<p>where &#39;<b>aliasdomain</b>&#39; can use wildcards:</p>

<pre><code> &quot;simpson.org&quot;   &quot;simpson.com&quot;
 &quot;*.homer.net&quot;   &quot;homer.net&quot;</code></pre>

<p>The first line defines &#39;<b>simpson.org</b>&#39; as an alias of &#39;<b>simpson.com</b>&#39; while the second remaps all subdomains of &#39;<b>homer.net</b>&#39; to &#39;<b>homer.net</b>&#39;.</p>

<p>You &#39;<b>CANNOT</b>&#39; edit this file while XMail is running because it is an indexed file.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="DOMAINS.TAB">DOMAINS.TAB</h3>

<pre><code> &quot;domain&quot;[NEWLINE]</code></pre>

<p>defines domains handled by the server.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="DNSROOTS">DNSROOTS</h3>

<pre><code> host</code></pre>

<p>This is a file that lists a root name server in each line (this is not a TAB file). This can be created from a query via nslookup for type=ns and host = &#39;.&#39;.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="EXTALIASES.TAB">EXTALIASES.TAB</h3>

<pre><code> &quot;external-domain&quot;[TAB]&quot;external-account&quot;[TAB]&quot;local-domain&quot;[TAB]&quot;local-user&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;xmailserver.org&quot;   &quot;dlibenzi&quot;  &quot;home.bogus&quot;    &quot;dlibenzi&quot;</code></pre>

<p>This file is used in configurations in which the server does not run directly on Internet (like my case) but acts as internal mail exchanger and external mail gateway. This file defines &#39;Return-Path: &lt;...&gt;&#39; mapping for internal mail delivery. If you are using an Mail client like Outlook, Eudora, KMail ... you have to configure your email address with the external account say &#39;dlibenzi@xmailserver.org&#39;. When you post an internal message to &#39;foo@home.bogus&#39; the mail client puts your external email address (&#39;dlibenzi@xmailserver.org&#39;) in the &#39;MAIL FROM: &lt;...&gt;&#39; SMTP request. Now if the user &#39;foo&#39; replies to this message, it replies to &#39;dlibenzi@xmailserver.org&#39;, and then is sent to the external mail server. With the entry above in &#39;<b>EXTALIASES.TAB</b>&#39; file the &#39;Return-Path: &lt;...&gt;&#39; field is filled with &#39;dlibenzi@home.bogus&#39; that leads to an internal mail reply.</p>

<p>You &#39;<b>CANNOT</b>&#39; edit this file while XMail is running because it is an indexed file.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="MAILUSERS.TAB">MAILUSERS.TAB</h3>

<pre><code> &quot;domain&quot;[TAB]&quot;account&quot;[TAB]&quot;enc-passwd&quot;[TAB]&quot;account-id&quot;[TAB]&quot;account-dir&quot;[TAB]=&gt;
   &quot;account-type&quot;[NEWLINE]</code></pre>

<p>(remember, enter as one line.) Example:</p>

<pre><code> &quot;home.bogus&quot;    &quot;dlibenzi&quot;  &quot;XYZ...&quot;    1   &quot;dlibenzi&quot;  &quot;U&quot;</code></pre>

<p>defines an account &#39;dlibenzi&#39; in domain &#39;home.bogus&#39; with the encrypted password &#39;XYZ...&#39;, user id &#39;1&#39; and mail directory &#39;dlibenzi&#39; inside &#39;<b>$MAIL_ROOT/domains/home.bogus</b>&#39;. To allow multiple domain handling the POP3 client must use the entire email address for the POP3 user account; for example, if a user has email user@domain it must supply:</p>

<pre><code> user@domain</code></pre>

<p>as POP3 account login.</p>

<p>The directory &#39;account-dir&#39; &#39;<b>must</b>&#39; case match with the field &#39;account-dir&#39; of this file. Note that user id &#39;<b>must</b>&#39; be unique for all users (duplicate user ids are not allowed). The user id 0 is reserved by XMail and cannot be used.</p>

<p>The last field &#39;U&#39; is the account type:</p>

<pre><code> &quot;U&quot; = User account
 &quot;M&quot; = Mailing list account</code></pre>

<p>The encrypted password is generated by &#39;<b>XMCrypt</b>&#39; whose source is &#39;<b>XMCrypt.cpp</b>&#39;. Even if external authentication is used (see <a href="#External-Authentication">&quot;External Authentication&quot;</a>) this file &#39;<b>must</b>&#39; contain an entry for each user handled by XMail.</p>

<p>You &#39;<b>CANNOT</b>&#39; edit this file while XMail is running because it is an indexed file.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="MESSAGE.ID">MESSAGE.ID</h3>

<p>A file storing a sequential message number. Set it at 1 when you install the server and leave it be handled by the software.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="POP3LINKS.TAB">POP3LINKS.TAB</h3>

<pre><code> &quot;local-domain&quot;[TAB]&quot;local-account&quot;[TAB]&quot;external-domain&quot;[TAB]=&gt;
   &quot;external-account&quot;[TAB]&quot;external-crypted-password&quot;[TAB]&quot;authtype&quot;[NEWLINE]</code></pre>

<p>(remember, enter as one line) where:</p>

<p>&#39;<b>authtype</b>&#39; = Comma-separated list of options:</p>

<dl>

<dt id="CLR">CLR</dt>
<dd>

<p>Use clear-text USER/PASS authentication</p>

</dd>
<dt id="APOP">APOP</dt>
<dd>

<p>Use POP3 APOP authentication (that does not send clear-text passwords over the wire). Fall back to &#39;<b>CLR</b>&#39; if &#39;<b>APOP</b>&#39; is not supported</p>

</dd>
<dt id="FAPOP">FAPOP</dt>
<dd>

<p>Use POP3 APOP authentication (that does not send clear-text passwords over the wire).</p>

</dd>
<dt id="STLS">STLS</dt>
<dd>

<p>Establish an SSL link with the server by issuing a POP3 STLS command. Continue with the non-encrypted link if STLS is not supported</p>

</dd>
<dt id="FSTLS">FSTLS</dt>
<dd>

<p>Establish an SSL link with the server by issuing a POP3 STLS command.</p>

</dd>
<dt id="POP3S">POP3S</dt>
<dd>

<p>Establish a full POP3S connection with the remote server. Note that the POP3S port (default 995) must be set inside the external domain declaration.</p>

</dd>
<dt id="Leave">Leave</dt>
<dd>

<p>Leave messages on the server, and download only the new ones. In order for this functionality to work, the remote POP3 server must support the UIDL command.</p>

</dd>
<dt id="OutBind">OutBind</dt>
<dd>

<p>Sets the IP address of the network interface that should be used when connecting to the remote host. This configuration should be used carefully, because XMail will fail if the selected IP of the interface does not have a route to the remote host using such IP.</p>

</dd>
</dl>

<p>Examples:</p>

<pre><code> &quot;home.bogus&quot;    &quot;dlibenzi&quot;  &quot;xmailserver.org&quot;   &quot;dlibenzi&quot; &quot;XYZ...&quot;=&gt;
   &quot;APOP&quot;</code></pre>

<p>This entry is used to synchronize the external account &#39;dlibenzi@xmailserver.org&#39; with encrypted password &#39;XYZ...&#39; with the local account &#39;dlibenzi@home.bogus&#39; using &#39;<b>APOP</b>&#39; authentication. It connects with the &#39;xmailserver.org&#39; POP3 server and downloads all messages for &#39;dlibenzi@xmailserver.org&#39; into the local account &#39;dlibenzi@home.bogus&#39;. The remote server must support &#39;<b>APOP</b>&#39; authentication to specify &#39;<b>APOP</b>&#39; as authtype. Even if using APOP authentication is more secure because clear usernames and password do not travel on the network, when you&#39;re not sure about it, specify &#39;<b>CLR</b>&#39; as authtype. For non local POP3 sync you&#39;ve to specify a line like this one (@ as the first domain char):</p>

<pre><code> &quot;@home.bogus.com&quot;   &quot;dlibenzi&quot;  &quot;xmailserver.org:110&quot;   &quot;dlibenzi&quot; &quot;XYZ...&quot;=&gt;
   &quot;CLR&quot;</code></pre>

<p>This entry is used to synchronize the external account &#39;dlibenzi@xmailserver.org&#39; with encrypted password &#39;XYZ...&#39; with the account &#39;dlibenzi@home.bogus.com&#39; using &#39;<b>CLR</b>&#39; authentication. The message is pushed into the spool having as destination dlibenzi@home.bogus.com , so you&#39;ve to have some kind of processing for that user or domain in your XMail configuration (for example custom domain processing). you can also have the option to setup a line like this one:</p>

<pre><code> &quot;?home.bogus.com,felins.net,pets.org&quot;   &quot;dlibenzi&quot;  &quot;xmailserver.org&quot;=&gt;
   &quot;dlibenzi&quot;  &quot;XYZ...&quot;    &quot;CLR&quot;</code></pre>

<p>and messages are dropped inside the spool by following these rules:</p>

<ol>

<li><p>XMail parses the message headers by searching for To:, Cc: and Bcc: addresses.</p>

</li>
<li><p>Each address&#39;s domain is compared with the list of valid domains (felins.net, pets.org).</p>

</li>
<li><p>For each valid address the username part is taken and joined with the &#39;@&#39; and the masquerade domain name (the name following &#39;?&#39;).</p>

</li>
<li><p>The message is spooled with the above built destination address.</p>

</li>
</ol>

<p>Obviously the masquerade domain (&#39;home.bogus.com&#39;) MUST be handled by the server or MUST be a valid external mail domain. So if a message having as To: address graycat@felins.net is fetched by the previous line a message is pushed into the spool with address graycat@home.bogus.com. Particular attention must be paid to prevent creating mail loops. Another option is:</p>

<pre><code> &quot;&amp;.local,felins.net,pets.org&quot;   &quot;dlibenzi&quot;  &quot;xmailserver.org&quot; &quot;dlibenzi&quot;=&gt;
   &quot;XYZ...&quot;    &quot;CLR&quot;</code></pre>

<p>where a fetched message whose To: address is graycat@felins.net is replaced with graycat@felins.net.local. You can avoid the matching domain list after the masquerading domain but, in that case, you may have bad destination addresses inside the spool. The list MUST be comma separated WITHOUT spaces. XMail starts PSYNC session with a delay that you can specify with the -Yi nsec command line parameter (default 120). XMail also checks for the presence (inside MAIL_ROOT) of a file named &#39;.psync-trigger&#39; and, when this file is found, a PSYNC session starts and that file is removed.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SERVER.TAB">SERVER.TAB</h3>

<pre><code> &quot;varname&quot;[TAB]&quot;varvalue&quot;[NEWLINE]</code></pre>

<p>This file contains server configuration variables. See <a href="#SERVER.TAB-variables">&quot;SERVER.TAB variables&quot;</a> below for details.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTPGW.TAB">SMTPGW.TAB</h3>

<pre><code> &quot;domain&quot;[TAB]&quot;smtp-gateway&quot;[NEWLINE]</code></pre>

<p>Examples:</p>

<pre><code> &quot;foo.example.com&quot;   &quot;@xmailserver.org&quot;</code></pre>

<p>sends all mail for &#39;foo.example.com&#39; through the &#39;xmailserver.org&#39; SMTP server, while:</p>

<pre><code> &quot;*.dummy.net&quot;   &quot;@relay.xmailserver.org&quot;</code></pre>

<p>sends all mail for &#39;*.dummy.net&#39; through &#39;relay.xmailserver.org&#39;.</p>

<p>The &#39;<b>smtp-gateway</b>&#39; can be a complex routing also, for example:</p>

<pre><code> &quot;*.dummy.net&quot;   &quot;@relay.xmailserver.org,@mail.nowhere.org&quot;</code></pre>

<p>sends all mail for &#39;*.dummy.net&#39; through &#39;@relay.xmailserver.org,@mail.nowhere.org&#39;, in this way: relay.xmailserver.org --&gt; mail.nowhere.org --&gt; @DESTINATION.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTPFWD.TAB">SMTPFWD.TAB</h3>

<pre><code> &quot;domain&quot;[TAB]&quot;smtp-mx-list&quot;[NEWLINE]</code></pre>

<p>The &quot;smtp-mx-list&quot; is a semicolon separated list of SMTP relays, and can also contain options as a comma-separated list (see [<a href="#SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</a>] for more information).</p>

<p>Examples:</p>

<pre><code> &quot;foo.example.com&quot;   &quot;mail.xmailserver.org:7001;192.168.1.1:6123,NeedTLS=1;mx.xmailserver.org&quot;</code></pre>

<p>sends all mail for &#39;foo.example.com&#39; using the provided list of mail exchangers, while:</p>

<pre><code> &quot;*.dummy.net&quot;   &quot;mail.xmailserver.org,NeedTLS=1;192.168.1.1;mx.xmailserver.org:6423&quot;</code></pre>

<p>sends all mail for &#39;*.dummy.net&#39; through the provided list of mail exchangers. If the port (:nn) is not specified the default SMTP port (25) is assumed. you can also enable XMail to random-select the order of the gateway list by specifying:</p>

<pre><code> &quot;*.dummy.net&quot;   &quot;#mail.xmailserver.org;192.168.1.1;mx.xmailserver.org:6423&quot;</code></pre>

<p>using the character &#39;<b>#</b>&#39; as the first char of the gateway list.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTPRELAY.TAB">SMTPRELAY.TAB</h3>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;212.131.173.0&quot;   &quot;255.255.255.0&quot;</code></pre>

<p>allows all hosts of the class &#39;C&#39; network &#39;212.131.173.XXX&#39; to use the server as relay.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTPAUTH.TAB">SMTPAUTH.TAB</h3>

<pre><code> &quot;username&quot;[TAB]&quot;password&quot;[TAB]&quot;permissions&quot;[NEWLINE]</code></pre>

<p>is used to permit SMTP client authentication with protocols PLAIN, LOGIN, CRAM-MD5 and custom. With custom authentication a file containing all secrets (username + &#39;:&#39; + password) is passed as parameter to the custom authentication program which tests all secrets to find the one matching (if exist). For this reason it&#39;s better to keep the number of entries in this file as low as possible. Permissions are a string that can contain:</p>

<dl>

<dt id="M">M</dt>
<dd>

<p>open mailing features</p>

</dd>
<dt id="R">R</dt>
<dd>

<p>open relay features (bypass all other relay blocking traps)</p>

</dd>
<dt id="V">V</dt>
<dd>

<p>VRFY command enabled (bypass SERVER.TAB variable)</p>

</dd>
<dt id="T">T</dt>
<dd>

<p>ETRN command enabled (bypass SERVER.TAB variable)</p>

</dd>
<dt id="Z">Z</dt>
<dd>

<p>disable mail size checking (bypass SERVER.TAB variable)</p>

</dd>
<dt id="S">S</dt>
<dd>

<p>ease SSL requirement for this user (bypass the &quot;WantTLS&quot; mail config variable)</p>

</dd>
</dl>

<p>When PLAIN, LOGIN or CRAM-MD5 authentication mode are used, first a lookup in &#39;<b>MAILUSERS.TAB</b>&#39; accounts is performed to avoid duplicating information with &#39;<b>SMTPAUTH.TAB</b>&#39;. Therefore when using these authentication modes a user must use as username the full email address (the : separator is permitted instead of @) and as password his POP3 password. If the lookup succeeds, the &#39;<b>SERVER.TAB</b>&#39; variable &#39;<b>DefaultSmtpPerms</b>&#39; is used to assign user SMTP permissions (default MR). If the lookup fails then &#39;<b>SMTPAUTH.TAB</b>&#39; lookup is done.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTPEXTAUTH.TAB">SMTPEXTAUTH.TAB</h3>

<p>The &#39;<b>SMTPEXTAUTH.TAB</b>&#39; file enables the XMail administrator to use external authentication methods to verify SMTP clients. If the &#39;<b>SMTPEXTAUTH.TAB</b>&#39; does not exist, or it is empty, XMail standard authentication methods are used, and those will use either the &#39;<b>MAILUSERS.TAB</b>&#39; or the &#39;<b>SMTPAUTH.TAB</b>&#39; to verify account credentials. If the file &#39;<b>SMTPEXTAUTH.TAB</b>&#39; is not empty, then the XMail standard authentication methods are not advertised in the <b>AUTH</b> response of the <b>EHLO</b> SMTP command. Instead, only the ones listed inside the &#39;<b>SMTPEXTAUTH.TAB</b>&#39; are reported to the SMTP client. The &#39;<b>SMTPEXTAUTH.TAB</b>&#39; file can contain multiple lines with the following format:</p>

<pre><code> &quot;auth-name&quot;[TAB]&quot;program-path&quot;[TAB]&quot;arg-or-macro&quot;...[NEWLINE]</code></pre>

<p>This file can contain multiple lines whose &#39;<b>auth-name</b>&#39; are listed during the EHLO command response. Where &#39;arg-or-macro&#39; can be (see [<a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a>]):</p>

<dl>

<dt id="AUTH">AUTH</dt>
<dd>

<p>authentication method (PLAIN, LOGIN, CRAM-MD5, ...)</p>

</dd>
<dt id="USER">USER</dt>
<dd>

<p>SMTP client supplied username (available in PLAIN, LOGIN and CRAM-MD5)</p>

</dd>
<dt id="PASS">PASS</dt>
<dd>

<p>SMTP client supplied password (available in PLAIN and LOGIN)</p>

</dd>
<dt id="CHALL">CHALL</dt>
<dd>

<p>challenge used by the server (available in CRAM-MD5)</p>

</dd>
<dt id="DGEST">DGEST</dt>
<dd>

<p>client response to server challenge (@CHALL - available in CRAM-MD5)</p>

</dd>
<dt id="RFILE">RFILE</dt>
<dd>

<p>a file path where the external authentication binary might supply extra information/credentials about the account (available in all authentications)</p>

</dd>
</dl>

<p>The <b>RFILE</b> file is composed by multiple lines with the following format:</p>

<pre><code>  VAR=VALUE</code></pre>

<p>Currently supported variables inside the <b>RFILE</b> file are:</p>

<dl>

<dt id="Perms">Perms</dt>
<dd>

<p>Supply SMTP permissions for the account (see [<a href="#SMTPAUTH.TAB">SMTPAUTH.TAB</a>] for detailed information)</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;PLAIN&quot; &quot;/usr/bin/my-auth&quot; &quot;-a&quot; &quot;@@AUTH&quot; &quot;-u&quot; &quot;@@USER&quot; &quot;-p&quot; &quot;@@PASS&quot; &quot;-r&quot; &quot;@@RFILE&quot;</code></pre>

<p>The external authentication binary may or may not fill a response file. If the authentication has been successful, the binary should exit with a code equal to zero. Any other exit code different from zero, will be interpreted as failure.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="USERDEF.TAB">USERDEF.TAB</h3>

<pre><code> &quot;varname&quot;[TAB]&quot;varvalue&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;RealName&quot;  &quot;??&quot;
 &quot;HomePage&quot;  &quot;??&quot;
 &quot;Address&quot;   &quot;??&quot;
 &quot;Telephone&quot; &quot;??&quot;
 &quot;MaxMBSize&quot; &quot;10000&quot;</code></pre>

<p>contains user default values for new users that are not set during the new account creation. This file is looked up in two different places, first in &#39;<b>$MAIL_ROOT/domains/DOMAIN</b>&#39; then in &#39;<b>$MAIL_ROOT</b>&#39;, where &#39;<b>DOMAIN</b>&#39; is the name of the domain where we&#39;re going to create the new user.</p>

<p>For each &#39;domain&#39; handled by the server we&#39;ll create a directory &#39;domain&#39; inside $MAIL_ROOT. Inside $MAIL_ROOT/&#39;domain&#39; reside &#39;domain&#39;-&gt;&#39;account&#39; directories ($MAIL_ROOT/&#39;domain&#39;/&#39;account&#39;). This folder contains a sub folder named &#39;<b>mailbox</b>&#39; (or &#39;<b>Maildir/(tmp,new,cur)</b>&#39;) that stores all &#39;account&#39; messages. It also contains a file named &#39;<b>USER.TAB</b>&#39; that stores &quot;account&quot; variables, for example:</p>

<pre><code> &quot;RealName&quot;  &quot;Davide Libenzi&quot;
 &quot;HomePage&quot;  &quot;http://www.xmailserver.org/davide.html&quot;
 &quot;MaxMBSize&quot; &quot;30000&quot;</code></pre>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="CTRLACCOUNTS.TAB">CTRLACCOUNTS.TAB</h3>

<pre><code> &quot;username&quot;[TAB]&quot;password&quot;[NEWLINE]</code></pre>

<p>This file contains the accounts that are enabled to remote administer XMail. The password is encrypted with the &#39;<b>XMCrypt</b>&#39; program supplied with the source distro.</p>

<p>&#39;<b>REMEMBER THAT THIS FILE HOLDS ADMIN ACCOUNTS, SO PLEASE CHOOSE COMPLEX USERNAMES AND PASSWORDS AND USE CTRL.IPMAP.TAB TO RESTRICT IP ACCESS! REMEMBER TO REMOVE THE EXAMPLE ACCOUNT FROM THIS FILE!</b>&#39;</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SPAMMERS.TAB">SPAMMERS.TAB</h3>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[NEWLINE]</code></pre>

<p>or:</p>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;params&quot;[NEWLINE]</code></pre>

<p>or:</p>

<pre><code> &quot;ipaddr/bits&quot;[NEWLINE]</code></pre>

<p>or:</p>

<pre><code> &quot;ipaddr/bits&quot;[TAB]&quot;params&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;
 &quot;212.131.173.0/24&quot;</code></pre>

<p>registers all hosts of the class &#39;C&#39; network &#39;212.131.173.XXX&#39; as spammers, and blocks them the use of XMail SMTP server. If a match is found on one of those records, XMail will reject the incoming SMTP connection at an early stage. It is possible to specify optional parameters to tell XMail which behaviour it should assume in case of a match. An example of such a setup is:</p>

<pre><code> &quot;212.131.173.0/24&quot;  &quot;code=0&quot;</code></pre>

<p>In this case a code=0 tells XMail to flag the connection as possible spammer, but to await later SMTP session stages to reject the connection itself. In this case an authenticated SMTP session can override the SPAMMERS.TAB match. The optional &quot;params&quot; field lists parameters associated with the record, separated by a comma:</p>

<pre><code> &quot;param1=value1,param2=value2,...,paramN=valueN&quot;</code></pre>

<p>Currently supported parameters are:</p>

<dl>

<dt id="code">code</dt>
<dd>

<p>Specify the rejection code for the record. If the value is greater than zero, the connection is rejected soon, and the remote SMTP client is disconnected. If the value is zero, the connection is flagged as spammer but awaits later stages for rejection, by allowing authenticated SMTP connections to bypass the SPAMMERS.TAB match. If the value is less than zero, XMail will insert an &quot;absolute value&quot; seconds delay between SMTP commands. Default value for code is greater than zero (immediate rejection).</p>

</dd>
</dl>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SPAM-ADDRESS.TAB">SPAM-ADDRESS.TAB</h3>

<pre><code> &quot;spam-address&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;*@rude.net&quot;
 &quot;*-admin@even.more.rude.net&quot;</code></pre>

<p>blocks mails coming from the entire domain &#39;<b>rude.net</b>&#39; and coming from all addresses that end with &#39;<b>-admin@&#39;even.more.rude.net</b>.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="POP3.IPMAP.TAB">POP3.IPMAP.TAB</h3>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</code></pre>

<p>This file controls the global IP access permission to the POP3 server if located in the MAIL_ROOT path, and user IP access to its POP3 mailbox if located inside the user directory.</p>

<p>Example:</p>

<pre><code> &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</code></pre>

<p>This configuration denies access to all IPs except the ones of the class &#39;C&#39; network &#39;212.131.173.XXX&#39;.</p>

<p>Higher precedences win over lower ones.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTP.IPMAP.TAB">SMTP.IPMAP.TAB</h3>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</code></pre>

<p>This file controls IP access permission to SMTP server.</p>

<p>Example:</p>

<pre><code> &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</code></pre>

<p>This configuration denies access to all IPs except the ones of the class &#39;C&#39; network &#39;212.131.173.XXX&#39;.</p>

<p>Higher precedences win over lower ones.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="CTRL.IPMAP.TAB">CTRL.IPMAP.TAB</h3>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</code></pre>

<p>This file control IP access permission to CTRL server. Example:</p>

<pre><code> &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</code></pre>

<p>This configuration deny access to all IPs except the ones of the class &#39;C&#39; network &#39;212.131.173.XXX&#39;. Higher precedences win over lower ones.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="FINGER.IPMAP.TAB">FINGER.IPMAP.TAB</h3>

<pre><code> &quot;ipaddr&quot;[TAB]&quot;netmask&quot;[TAB]&quot;permission&quot;[TAB]&quot;precedence&quot;[NEWLINE]</code></pre>

<p>This file controls IP access permission to FINGER server. Example:</p>

<pre><code> &quot;0.0.0.0&quot;  &quot;0.0.0.0&quot;  &quot;DENY&quot;  &quot;1&quot;
 &quot;212.131.173.0&quot;  &quot;255.255.255.0&quot;  &quot;ALLOW&quot;  &quot;2&quot;</code></pre>

<p>This configuration denies access to all IPs except the ones of the class &#39;C&#39; network &#39;212.131.173.XXX&#39;. Higher precedences win over lower ones.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="USER.TAB">USER.TAB</h3>

<pre><code> &quot;variable&quot;[TAB]&quot;value&quot;[NEWLINE]</code></pre>

<p>store user information such as:</p>

<pre><code> &quot;RealName&quot;  &quot;Davide Libenzi&quot;
 &quot;HomePage&quot;  &quot;http://www.xmailserver.org/davide.html&quot;
 &quot;MaxMBSize&quot; &quot;30000&quot;
 &quot;ClosedML&quot;  &quot;0&quot;</code></pre>

<p>Please refer to <a href="#USER.TAB-variables">&quot;USER.TAB variables&quot;</a> below.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="MLUSERS.TAB">MLUSERS.TAB</h3>

<p>If the user is a mailing list this file must exist inside the user account subdirectory and contain a list of users subscribed to this list. The file format is:</p>

<pre><code> &quot;user&quot;[TAB]&quot;perms&quot;[NEWLINE]</code></pre>

<p>where:</p>

<dl>

<dt id="user">user</dt>
<dd>

<p>subscriber email address.</p>

</dd>
<dt id="perms">perms</dt>
<dd>

<p>subscriber permissions:</p>

<dl>

<dt id="R1">R</dt>
<dd>

<p>read.</p>

</dd>
<dt id="W">W</dt>
<dd>

<p>write (check done using the &#39;MAIL FROM:&lt;...&gt;&#39; SMTP return path).</p>

</dd>
<dt id="A">A</dt>
<dd>

<p>write (check done using the email address used for SMTP authentication).</p>

</dd>
</dl>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;davidel@xmailserver.org&quot;   &quot;RW&quot;
 &quot;ghostuser@nightmare.net&quot;   &quot;R&quot;
 &quot;meawmeaw@kitty.cat&quot;        &quot;RA&quot;</code></pre>

<p>If the &#39;<b>USER.TAB</b>&#39; file defines the &#39;<b>ClosedML</b>&#39; variable as &#39;<b>1</b>&#39; then a client can post to this mailing list only if it&#39;s listed in &#39;<b>MLUSERS.TAB</b>&#39; with RW permissions.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="MAILPROC.TAB">MAILPROC.TAB</h3>

<pre><code> &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>stores commands (internals or externals) that have to be executed on a message file. The presence of this file is optional and if it does not exist the default processing is to store the message in user mailbox. The &#39;<b>MAILPROC.TAB</b>&#39; file can be either per user or per domain, depending where the file is stored. If stored inside the user directory it applies only to the user whose directory hosts the &#39;<b>MAILPROC.TAB</b>&#39;, while if stored inside the domain directory it applies to all users of such domain. Each argument can be a macro also (see [<a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a>]):</p>

<dl>

<dt id="FROM">FROM</dt>
<dd>

<p>is substituted for the sender of the message</p>

</dd>
<dt id="RCPT">RCPT</dt>
<dd>

<p>is substituted for the recipient of the message</p>

</dd>
<dt id="RRCPT">RRCPT</dt>
<dd>

<p>is substituted for the real recipient ($(RCPT) could be an alias) of the message</p>

</dd>
<dt id="FILE">FILE</dt>
<dd>

<p>is substituted for the message file path (the external command _must_ only read the file)</p>

</dd>
<dt id="MSGID">MSGID</dt>
<dd>

<p>is substituted for the (XMail unique) message id</p>

</dd>
<dt id="MSGREF">MSGREF</dt>
<dd>

<p>is substituted for the reference SMTP message id</p>

</dd>
<dt id="TMPFILE">TMPFILE</dt>
<dd>

<p>creates a copy of the message file to a temporary one. It can be used with &#39;external&#39; command but in this case it&#39;s external program responsibility to delete the temporary file. Do not use it with &#39;filter&#39; commands since the filter will have no way to modify the real spool file</p>

</dd>
<dt id="USERAUTH">USERAUTH</dt>
<dd>

<p>name of the SMTP authenticated user, or &quot;-&quot; if no authentication has been supplied</p>

</dd>
</dl>

<p>Supported commands:</p>

<p>[EXTERNAL]</p>

<pre><code> &quot;external&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>where:</p>

<dl>

<dt id="external">external</dt>
<dd>

<p>command keyword</p>

</dd>
<dt id="priority">priority</dt>
<dd>

<p>process priority: 0 = normal -1 = below normal +1 = above normal</p>

</dd>
<dt id="wait-timeout">wait-timeout</dt>
<dd>

<p>wait timeout for process execution in seconds: 0 = nowait</p>

<p>Be careful if using $(FILE) to give the external command enough timeout to complete, otherwise the file will be removed by XMail while the command is processing. This is because such file is a temporary one that is deleted when XMail exits from &#39;<b>MAILPROC.TAB</b>&#39; file processing. In case the external command exit code will be &#39;<b>16</b>&#39;, the command processing will stop and all the following commands listed inside the file will be skipped.</p>

</dd>
</dl>

<p>[FILTER]</p>

<pre><code> &quot;filter&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>where:</p>

<dl>

<dt id="filter">filter</dt>
<dd>

<p>command keyword</p>

</dd>
<dt id="priority1">priority</dt>
<dd>

<p>process priority: 0 = normal -1 = below normal +1 = above normal</p>

</dd>
<dt id="wait-timeout1">wait-timeout</dt>
<dd>

<p>wait timeout for process execution in seconds: 0 = nowait</p>

<p>With filters, it is not suggested to use $(TMPFILE), since the filter will never have the ability to change the message content in that way. Also, to avoid problems very difficult to troubleshoot, it is suggested to give the filter &#39;<b>ENOUGH</b>&#39; timeout to complete (90 seconds or more). See [<a href="#MESSAGE-FILTERS">MESSAGE FILTERS</a>] for detailed information about return codes. In the filter command, the &quot;Stop Filter Processing&quot; return flag will make XMail to stop the execution of the current custom processing file.</p>

</dd>
</dl>

<p>The &#39;filter&#39; command will pass the message file to a custom external filter, that after inspecting it, has the option to accept, reject or modify it. Care should be taken to properly re-format the message after changing it, to avoid message corruption. The &#39;filter&#39; command &#39;<b>CANNOT</b>&#39; successfully change the private XMail&#39;s header part of the spool message.</p>

<p>[MAILBOX]</p>

<pre><code> &quot;mailbox&quot;[NEWLINE]</code></pre>

<p>With this command the message is pushed into local user mailbox.</p>

<p>[REDIRECT]</p>

<pre><code> &quot;redirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</code></pre>

<p>Redirect message to internal or external domain or email address. If the message was for foo-user@custdomain.net and the file custdomain.net.tab contains a line:</p>

<pre><code> &quot;redirect&quot;  &quot;target-domain.org&quot;</code></pre>

<p>the message is delivered to &#39;<b>foo-user@target-domain.org</b>&#39;.</p>

<p>While the line:</p>

<pre><code> &quot;redirect&quot;  &quot;user@target-domain.org&quot;</code></pre>

<p>redirects the message to user@target-domain.org.</p>

<p>[LREDIRECT]</p>

<pre><code> &quot;lredirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</code></pre>

<p>Redirect the message to internal or external domain (or email address) impersonating local domain during messages delivery. If the message was for foo-user@custdomain.net and the file custdomain.net.tab contains a line:</p>

<pre><code> &quot;redirect&quot;  &quot;target-domain.org&quot;</code></pre>

<p>the message is delivered to &#39;<b>foo-user@target-domain.org</b>&#39;.</p>

<p>While the line:</p>

<pre><code> &quot;redirect&quot;  &quot;user@target-domain.org&quot;</code></pre>

<p>redirects the message to &#39;<b>user@target-domain.org</b>&#39;. The difference between &quot;redirect&quot; and &quot;lredirect&quot; is the following. Suppose A@B sends a message to C@D, that has a redirect to E@F. With &quot;redirect&quot; E@F will see A@B has sender while with &quot;lredirect&quot; he will see C@D.</p>

<p>[SMTPRELAY]</p>

<pre><code> &quot;smtprelay&quot;[TAB]&quot;server[:port][,options];server[:port][,options];...&quot;[NEWLINE]</code></pre>

<p>Send mail to the specified SMTP server list by trying the first, if fails the second and so on. Otherwise You can use this syntax:</p>

<pre><code> &quot;smtprelay&quot;[TAB]&quot;#server[:port][,options];server[:port][,options];...&quot;[NEWLINE]</code></pre>

<p>to have XMail random-select the order the specified relays. Each gateway definition can also contain options as a comma-separated list (see [<a href="#SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</a>] for more information).</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTP.IPPROP.TAB">SMTP.IPPROP.TAB</h3>

<p>This file lists SMTP properties to be associated with the remote SMTP peer IP. The format of the file is:</p>

<pre><code> &quot;ip-addr&quot;[TAB]&quot;var0=value0&quot;...[TAB]&quot;varN=valueN&quot;[NEWLINE]</code></pre>

<p>Example:</p>

<pre><code> &quot;192.168.0.7/32&quot;   &quot;WhiteList=1&quot;</code></pre>

<p>Address selection mask are formed by an IP address (network) plus the number of valid bits inside the network mask. No space are allowed between the variable name and the &#39;=&#39; sign and between the &#39;=&#39; sign and the value. These are the currently defined variables:</p>

<dl>

<dt id="WhiteList">WhiteList</dt>
<dd>

<p>If set to 1, all peer IP based checks will be skipped.</p>

</dd>
<dt id="EaseTLS">EaseTLS</dt>
<dd>

<p>If set to 1, drops the TLS requirement for SMTP sessions coming from the matched network.</p>

</dd>
<dt id="SenderDomainCheck">SenderDomainCheck</dt>
<dd>

<p>If set to 0, bypasses the &quot;CheckMailerDomain&quot; &#39;<b>SERVER.TAB</b>&#39; variable.</p>

</dd>
<dt id="NoAuth">NoAuth</dt>
<dd>

<p>If set to 1, release the authentication policy for this IP.</p>

</dd>
<dt id="EnableVRFY">EnableVRFY</dt>
<dd>

<p>If set to 1, enable VRFY commands from this IP.</p>

</dd>
<dt id="EnableETRN">EnableETRN</dt>
<dd>

<p>If set to 1, enable ETRN commands from this IP.</p>

</dd>
</dl>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="SMTP.HNPROP.TAB">SMTP.HNPROP.TAB</h3>

<p>This file lists SMTP properties to be associated with the remote SMTP peer host name. The format of the file is:</p>

<pre><code> &quot;host-spec&quot;[TAB]&quot;var0=value0&quot;...[TAB]&quot;varN=valueN&quot;[NEWLINE]</code></pre>

<p>If the &quot;host-spec&quot; starts with a dot (&#39;.&#39;), the properties listed for that record will be applied to all sub-domains of the &quot;host-spec&quot; domain. Since applying the &#39;<b>SMTP.HNPROP.TAB</b>&#39; rules requires a DNS PTR lookup of the peer IP, you should be aware that this might introduce latencies into the XMail processing. If you do not have any hostname-based rules, do not create the &#39;<b>SMTP.HNPROP.TAB</b>&#39; file at all, since the simple existence of the file would trigger the DNS PTR lookup. Example:</p>

<pre><code> &quot;xmailserver.org&quot;   &quot;WhiteList=1&quot;   &quot;EaseTLS=1&quot;</code></pre>

<p>or:</p>

<pre><code> &quot;.xmailserver.org&quot;   &quot;WhiteList=1&quot;   &quot;EaseTLS=1&quot;</code></pre>

<p>See [<a href="#SMTP.IPPROP.TAB">SMTP.IPPROP.TAB</a>] for information about the properties allowed to be listed in this file.</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="FILTERS.IN.TAB">FILTERS.IN.TAB</h3>

<p>See [<a href="#MESSAGE-FILTERS">MESSAGE FILTERS</a>]</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="FILTERS.OUT.TAB">FILTERS.OUT.TAB</h3>

<p>See [<a href="#MESSAGE-FILTERS">MESSAGE FILTERS</a>]</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="FILTERS.POST-RCPT.TAB">FILTERS.POST-RCPT.TAB</h3>

<p>See [<a href="#SMTP-MESSAGE-FILTERS">SMTP MESSAGE FILTERS</a>]</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="FILTERS.PRE-DATA.TAB">FILTERS.PRE-DATA.TAB</h3>

<p>See [<a href="#SMTP-MESSAGE-FILTERS">SMTP MESSAGE FILTERS</a>]</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h3 id="FILTERS.POST-DATA.TAB">FILTERS.POST-DATA.TAB</h3>

<p>See [<a href="#SMTP-MESSAGE-FILTERS">SMTP MESSAGE FILTERS</a>]</p>

<p>[<a href="#Configuration-tables">table index</a>] [<a href="#Configuration">configuration</a>] [<a href="#index__">top</a>]</p>

<h1 id="MACRO-SUBSTITUTION">MACRO SUBSTITUTION</h1>

<p>XMail support two kinds of macro declaration inside its TAB file. The old macro declaration done by prefixing the macro name with the &#39;<b>@@</b>&#39; sequence is still supported for backward compatibility, and has to be used when the macro is the only content of the parameter. Macro can also be declared as &#39;<b>$(MACRO)</b>&#39; and this form can be used anywhere inside the parameter declaration, like:</p>

<pre><code> &quot;/var/spool/mail/$(USER).dat&quot;</code></pre>

<p>[<a href="#index__">top</a>]</p>

<h1 id="EXTERNAL-AUTHENTICATION">EXTERNAL AUTHENTICATION</h1>

<p>You can use external modules (executables) to perform user authentication instead of using XMail &#39;<b>mailusers.tab</b>&#39; lookups. Inside the userauth directory you&#39;ll find one directory for each service whose authentication can be handled externally (see <a href="#SMTPEXTAUTH.TAB">&quot;SMTPEXTAUTH.TAB&quot;</a> for SMTP). Suppose We must authenticate &#39;<b>USERNAME</b>&#39; inside &#39;<b>DOMAIN</b>&#39;, XMail first tries to lookup (inside userauth/pop3) a file named:</p>

<p>&#39;<b>DOMAIN.tab</b>&#39;</p>

<p>else:</p>

<p>&#39;<b>.tab</b>&#39;</p>

<p>If one of these files is found, XMail authenticates &#39;<b>USERNAME</b>&#39; - &#39;<b>DOMAIN</b>&#39; using that file. The authentication file is a TAB file (see at the proper section in this document) which has the given structure:</p>

<pre><code> &quot;auth-action&quot;[TAB]&quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>Each argument can be a macro also (see [<a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a>]):</p>

<dl>

<dt id="USER1">USER</dt>
<dd>

<p>the USERNAME to authenticate</p>

</dd>
<dt id="DOMAIN">DOMAIN</dt>
<dd>

<p>the DOMAIN to authenticate</p>

</dd>
<dt id="PASSWD">PASSWD</dt>
<dd>

<p>the user password</p>

</dd>
<dt id="PATH">PATH</dt>
<dd>

<p>user path</p>

</dd>
</dl>

<p>The values for &#39;<b>auth-action</b>&#39; can be one of:</p>

<ul>

<p>item userauth</p>

<p>executed when user authentication is required</p>

<p>useradd</p>

<p>executed when a user need to be added</p>

<p>useredit</p>

<p>executed when a user change is required</p>

<p>userdel</p>

<p>executed when a user deletion is required</p>

<p>domaindrop</p>

<p>executed when all domain users need to be deleted</p>

</ul>

<p>The first line that stores the handling command for the requested action is executed as:</p>

<pre><code> command arg0 ... argN</code></pre>

<p>that must return zero if successful. Any other exit code is interpreted as authentication operation failure, that. in &#39;<b>userauth</b>&#39; case, means such user is not authenticated.</p>

<p>If the execution of the command fails for system reasons (command not found, access denied, etc ...) then the user is not authenticated.</p>

<p>If none of this file&#39;s id are found, then usual authentication is performed (&#39;<b>mailusers.tab</b>&#39;). The use of external authentication does not avoid the presence of the user entry in &#39;<b>mailusers.tab</b>&#39;.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SMTP-CLIENT-AUTHENTICATION">SMTP CLIENT AUTHENTICATION</h1>

<p>When a message is to be sent through an SMTP server that requires authentication, XMail provides a way to handle this task by if the &#39;<b>userauth/smtp</b>&#39; subdirectory is set up properly.</p>

<p>Suppose a mail is to be sent through the SMTP server &#39;<b>mail.foo.net</b>&#39;, this makes XMail to search for a file named (inside userauth/smtp):</p>

<p>&#39;<b>mail.foo.net.tab</b>&#39;</p>

<p>then:</p>

<p>&#39;<b>foo.net.tab</b>&#39;</p>

<p>then:</p>

<p>&#39;<b>net.tab</b>&#39;</p>

<p>If one of these files is found its content is used to authenticate the SMTP client session. The structure of this file, as the extension says, is the TAB one used for most of the configuration files inside XMail. Only the first valid line (uncommented #) is used to choose the authentication method and lines has this format:</p>

<pre><code> &quot;auth-type&quot;[TAB]&quot;param1&quot;...[TAB]&quot;paramN&quot;[NEWLINE]</code></pre>

<p>Valid lines are:</p>

<pre><code> &quot;PLAIN&quot; &quot;username&quot;  &quot;password&quot;</code></pre>

<p>or</p>

<pre><code> &quot;LOGIN&quot; &quot;username&quot;  &quot;password&quot;</code></pre>

<p>or</p>

<pre><code> &quot;CRAM-MD5&quot;  &quot;username&quot;  &quot;password&quot;</code></pre>

<p>[<a href="#index__">top</a>]</p>

<h1 id="CUSTOM-DOMAIN-MAIL-PROCESSING">CUSTOM DOMAIN MAIL PROCESSING</h1>

<p>If a message that has as target domain of &#39;<b>sub1.sub2.domain.net</b>&#39; arrives at the XMail server, &#39;<b>AND</b>&#39; XMail does not have a real domain &#39;<b>sub1.sub2.domain.net</b>&#39; inside its domain list, XMail decides if this domain gets a custom domain processing by trying to lookup:</p>

<pre><code> sub1.sub2.domain.net.tab
 .sub2.domain.net.tab
 .domain.net.tab
 .net.tab
 .tab</code></pre>

<p>inside the &#39;<b>custdomains</b>&#39; directory.</p>

<p>If one of these files is found the incoming mail gets custom domain processing by executing commands that are stored in such a file.</p>

<p>The format is:</p>

<pre><code> &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>These tables store commands (internals or externals) that have to be executed on the message file. The presence of one of these files is optional and if none exist the default processing is applied to the message via SMTP.</p>

<p>Each argument can be a macro also (see [<a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a>]):</p>

<dl>

<dt id="FROM1">FROM</dt>
<dd>

<p>the sender of the message</p>

</dd>
<dt id="RCPT1">RCPT</dt>
<dd>

<p>the target of the message</p>

</dd>
<dt id="FILE1">FILE</dt>
<dd>

<p>the message file path (the external command &#39;<b>must only read</b>&#39; the file)</p>

</dd>
<dt id="MSGID1">MSGID</dt>
<dd>

<p>the (XMail unique) message id</p>

</dd>
<dt id="MSGREF1">MSGREF</dt>
<dd>

<p>the reference SMTP message id</p>

</dd>
<dt id="TMPFILE1">TMPFILE</dt>
<dd>

<p>creates a copy of the message file to a temporary one. It can be used with &#39;external&#39; command but in this case it&#39;s external program&#39;s responsibility to delete the temporary file</p>

</dd>
<dt id="USERAUTH1">USERAUTH</dt>
<dd>

<p>name of the SMTP authenticated user, or &quot;-&quot; if no authentication has been supplied</p>

</dd>
</dl>

<p>Supported commands:</p>

<dl>

<dt id="EXTERNAL">[EXTERNAL]</dt>
<dd>

<pre><code> &quot;external&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>where:</p>

<dl>

<dt id="external1">external</dt>
<dd>

<p>command keyword</p>

</dd>
<dt id="priority2">priority</dt>
<dd>

<p>process priority: 0 = normal -1 = below normal +1 = above normal</p>

</dd>
<dt id="wait-timeout2">wait-timeout</dt>
<dd>

<p>wait timeout for process execution in seconds: 0 = nowait</p>

<p>Be careful if using $(FILE) to give the external command enough timeout to complete, otherwise the file will be removed by XMail while the command is processing. This is because such file is a temporary one that is deleted when XMail exits from file processing. In case the external command exit code will be &#39;<b>16</b>&#39;, the command processing will stop and all the following commands listed inside the file will be skipped.</p>

</dd>
</dl>

</dd>
<dt id="FILTER">[FILTER]</dt>
<dd>

<pre><code> &quot;filter&quot;[TAB]&quot;priority&quot;[TAB]&quot;wait-timeout&quot;[TAB]&quot;command-path&quot;[TAB]=&gt;
   &quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>where:</p>

<dl>

<dt id="filter1">filter</dt>
<dd>

<p>command keyword</p>

</dd>
<dt id="priority3">priority</dt>
<dd>

<p>process priority: 0 = normal -1 = below normal +1 = above normal</p>

</dd>
<dt id="wait-timeout3">wait-timeout</dt>
<dd>

<p>wait timeout for process execution in seconds: 0 = nowait</p>

<p>With filters, it is not suggested to use $(TMPFILE), since the filter will never have the ability to change the message content in that way. Also, to avoid problems very difficult to troubleshoot, it is suggested to give the filter &#39;<b>ENOUGH</b>&#39; timeout to complete (90 seconds or more). See [<a href="#MESSAGE-FILTERS">MESSAGE FILTERS</a>] for detailed information about return codes. In the filter command, the &quot;Stop Filter Processing&quot; return flag will make XMail to stop the execution of the current custom processing file.</p>

</dd>
</dl>

<p>The &#39;filter&#39; command will pass the message file to a custom external filter, that after inspecting it, has the option to accept, reject or modify it. Care should be taken to properly re-format the message after changing it, to avoid message corruption. The &#39;filter&#39; command &#39;<b>CANNOT</b>&#39; successfully change the private XMail&#39;s header part of the spool message.</p>

</dd>
<dt id="REDIRECT">[REDIRECT]</dt>
<dd>

<pre><code> &quot;redirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</code></pre>

<p>Redirect message to internal or external domain or email address. If the message was for foo-user@custdomain.net and the file custdomain.net.tab contains a line:</p>

<pre><code> &quot;redirect&quot;  &quot;target-domain.org&quot;</code></pre>

<p>the message is delivered to &#39;<b>foo-user@target-domain.org</b>&#39;.</p>

<p>While the line:</p>

<pre><code> &quot;redirect&quot;  &quot;user@target-domain.org&quot;</code></pre>

<p>redirects the message to user@target-domain.org.</p>

</dd>
<dt id="LREDIRECT">[LREDIRECT]</dt>
<dd>

<pre><code> &quot;lredirect&quot;[TAB]&quot;domain-or-emailaddress&quot;[TAB]...[NEWLINE]</code></pre>

<p>Redirect the message to internal or external domain (or email address) impersonating local domain during messages delivery. If the message was for foo-user@custdomain.net and the file custdomain.net.tab contains a line:</p>

<pre><code> &quot;redirect&quot;  &quot;target-domain.org&quot;</code></pre>

<p>the message is delivered to &#39;<b>foo-user@target-domain.org</b>&#39;.</p>

<p>While the line:</p>

<pre><code> &quot;redirect&quot;  &quot;user@target-domain.org&quot;</code></pre>

<p>redirects the message to &#39;<b>user@target-domain.org</b>&#39;. The difference between &quot;redirect&quot; and &quot;lredirect&quot; is the following. Suppose A@B sends a message to C@D, that has a redirect to E@F. With &quot;redirect&quot; E@F will see A@B has sender while with &quot;lredirect&quot; he will see C@D.</p>

</dd>
<dt id="SMTPRELAY">[SMTPRELAY]</dt>
<dd>

<pre><code> &quot;smtprelay&quot;[TAB]&quot;server[:port][,options];server[:port][,options];...&quot;[NEWLINE]</code></pre>

<p>Send mail to the specified SMTP server list by trying the first, if fails the second and so on. Otherwise You can use this syntax:</p>

<pre><code> &quot;smtprelay&quot;[TAB]&quot;#server[:port][,options];server[:port][,options];...&quot;[NEWLINE]</code></pre>

<p>to have XMail random-select the order the specified relays. Each gateway definition can also contain options as a comma-separated list (see [<a href="#SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</a>] for more information).</p>

</dd>
<dt id="SMTP">[SMTP]</dt>
<dd>

<pre><code> &quot;smtp&quot;[NEWLINE]</code></pre>

<p>Do SMTP delivery.</p>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="CMD-ALIASES">CMD ALIASES</h1>

<p>CmdAliases implement aliases that are handled only through commands and can be thought of as a user level implementation of custom domain processing commands. The command set is the same of the one that is described above (<a href="#Custom-domain-mail-processing">&quot;Custom domain mail processing&quot;</a>) and won&#39;t be explained again here.</p>

<p>For every handled domain (listed inside &#39;<b>domains.tab</b>&#39;) a directory with the same domain name is created inside the &#39;<b>cmdaliases</b>&#39; subdirectory. This directory is automatically created and removed when you add/remove domains through the CTRL protocol (or &#39;<b>CtrlClnt</b>&#39;).</p>

<p>When a mail for &#39;<b>USER@DOMAIN</b>&#39; is received by the server, the domain &#39;<b>DOMAIN</b>&#39; is to be handled locally, and the standard users/aliases lookup fails, a file named &#39;<b>USER.tab</b>&#39; is searched inside &#39;<b>$MAIL_ROOT/cmdaliases/DOMAIN</b>&#39;. If such file is found, commands listed inside the file (whose format must follow the one described in the previous section) are executed by the server as a matter of mail message processing. An important thing to remember is that all domain and user names, when applied to the file system, must be lower case.</p>

<p>The use of the command &#39;<b>[SMTP]</b>&#39; must be implemented with great care because it could create mail loops within the server.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SERVER.TAB-VARIABLES">SERVER.TAB VARIABLES</h1>

<p>The following variables are for use int the <a href="#SERVER.TAB">&quot;SERVER.TAB&quot;</a> configuration file.</p>

<dl>

<dt id="RootDomain">[RootDomain]</dt>
<dd>

<p>Indicate the primary domain for the server.</p>

</dd>
<dt id="SmtpServerDomain">[SmtpServerDomain]</dt>
<dd>

<p>If set, forces the domain name XMail uses inside the ESMTP greeting used to support CRAM-MD5 ESMTP authentication.</p>

</dd>
<dt id="POP3Domain">[POP3Domain]</dt>
<dd>

<p>Set the default domain for POP3 client connections.</p>

</dd>
<dt id="PostMaster">[PostMaster]</dt>
<dd>

<p>Set the postmaster address.</p>

</dd>
<dt id="ErrorsAdmin">[ErrorsAdmin]</dt>
<dd>

<p>The email address that receives notification messages for every message that has had delivery errors. If it is empty (allowed), the notification message is sent to the sender only.</p>

</dd>
<dt id="TempErrorsAdmin">[TempErrorsAdmin]</dt>
<dd>

<p>The email address that receives notification for temporary delivery failures. In case it&#39;s empty the notification message is sent to the sender only.</p>

</dd>
<dt id="DefaultSMTPGateways">[DefaultSMTPGateways]</dt>
<dd>

<p>A semicolon separated list of SMTP servers XMail &#39;<b>must</b>&#39; use to send its mails. The definition can also contain options as a comma-separated list (see [<a href="#SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</a>] for more information). Example:</p>

<pre><code>  &quot;192.168.0.1,NeedTLS=2;192.168.0.2&quot;</code></pre>

<p>This has the precedence over MX records.</p>

</dd>
<dt id="HeloDomain">[HeloDomain]</dt>
<dd>

<p>If this variable is specified and is not empty, its content is sent as HELO domain. Otherwise the reverse lookup of the local IP is sent as HELO domain. This helps to deal with remote SMTP servers that are set to check the reverse lookup of the incoming IP.</p>

</dd>
<dt id="CheckMailerDomain">[CheckMailerDomain]</dt>
<dd>

<p>Enable validation of the sender domain (&#39;MAIL FROM:&lt;...@xxx&gt;&#39;) by looking up DNS/MX entries.</p>

</dd>
<dt id="RemoveSpoolErrors">[RemoveSpoolErrors]</dt>
<dd>

<p>Indicate if mail has to be removed or stored in &#39;<b>froz</b>&#39; directory after a failure in delivery or filtering.</p>

</dd>
<dt id="NotifyMsgLinesExtra">[NotifyMsgLinesExtra]</dt>
<dd>

<p>Number of lines of the bounced message that have to be listed inside the notify message (lines after the headers section). Default is zero.</p>

</dd>
<dt id="NotifySendLogToSender">[NotifySendLogToSender]</dt>
<dd>

<p>Enable/Disable sending the message log file inside the notify message to the sender. Default is off (zero).</p>

</dd>
<dt id="NotifyTryPattern">[NotifyTryPattern]</dt>
<dd>

<p>List of delivery attempts that require the system to send a notification to the sender (and eventually to &#39;<b>TempErrorsAdmin</b>&#39;). The list is a comma separated list of numbers (with no extra spaces) as in:</p>

<pre><code> &quot;1,4,9&quot;</code></pre>

<p>Default is empty which means no notification is sent upon a delivery attempt failure.</p>

</dd>
<dt id="AllowNullSender">[AllowNullSender]</dt>
<dd>

<p>Enable null sender (&#39;MAIL FROM:&lt;&gt;&#39;) messages to be accepted by XMail.</p>

</dd>
<dt id="NoSenderBounce">[NoSenderBounce]</dt>
<dd>

<p>When building bounce messages, use the null SMTP sender (&#39;MAIL FROM:&lt;&gt;&#39;) instead of the &#39;<b>PostMaster</b>&#39; address. This will affect only the SMTP sender, while the message RFC822 headers will still contain the correct From: header.</p>

</dd>
<dt id="MaxMTAOps">[MaxMTAOps]</dt>
<dd>

<p>Set the maximum number of MTA relay steps before to declare the message as looped (default 16).</p>

</dd>
<dt id="ReceivedHdrType">[ReceivedHdrType]</dt>
<dd>

<p>Set the verbosity of the Received: message headers tag.</p>

<dl>

<dt id="pod0">&#39;0&#39;</dt>
<dd>

<p>Standard (client IP shown , server IP not). Default.</p>

</dd>
<dt id="pod1">&#39;1&#39;</dt>
<dd>

<p>Verbose (client IP shown , server IP shown)</p>

</dd>
<dt id="pod2">&#39;2&#39;</dt>
<dd>

<p>Strict (no IP shown)</p>

</dd>
<dt id="pod3">&#39;3&#39;</dt>
<dd>

<p>Same as 0 but the client IP is not shown if the client authenticate itself.</p>

</dd>
<dt id="pod4">&#39;4&#39;</dt>
<dd>

<p>Same as 1 but the client IP is not shown if the client authenticate itself.</p>

</dd>
</dl>

</dd>
<dt id="FetchHdrTags">[FetchHdrTags]</dt>
<dd>

<p>Set the list of headers tags to be used to extract addresses from POP3 fetched messages (<a href="#POP3LINKS.TAB">&quot;POP3LINKS.TAB&quot;</a>). This is a comma delimited list (no extra space or TABs must be included inside the list) as in:</p>

<pre><code> &quot;+X-Deliver-To,To,Cc&quot;</code></pre>

<p>Tags preceded by a &#39;+&#39; character make XMail stop scanning when an address is found inside the header tag.</p>

<p>Tags preceded by a &#39;+&#39; character must be listed before other tags.</p>

<p>The string &quot;+X-Deliver-To,To,Cc&quot; is the default if nothing is specified.</p>

</dd>
<dt id="SMTP-MaxErrors">[SMTP-MaxErrors]</dt>
<dd>

<p>Set the maximum number of errors allowed in a single SMTP session. When the maximum number of allowed errors is exceeded, the connection will be automatically dropped. If such variable is not set, or it is set to zero, the maximum number of errors will be unlimited.</p>

</dd>
<dt id="SmtpMsgIPBanSpammers">[SmtpMsgIPBanSpammers]</dt>
<dd>

<p>Used to set the message that is sent to the SMTP client when the client IP is listed inside the file SPAMMER.TAB.</p>

</dd>
<dt id="SmtpMsgIPBanSpamAddress">[SmtpMsgIPBanSpamAddress]</dt>
<dd>

<p>Used to set the message that is sent to the SMTP client when the client IP is listed inside the file SPAM-ADDRESS.TAB.</p>

</dd>
<dt id="SmtpMsgIPBanMaps">[SmtpMsgIPBanMaps]</dt>
<dd>

<p>Used to set the message that is sent to the SMTP client when the client IP is listed inside one of the &quot;CustMapsList&quot;.</p>

</dd>
<dt id="SmtpMsgIPBan">[SmtpMsgIPBan]</dt>
<dd>

<p>Used to set the message that is sent to the SMTP client when the client IP is listed inside the file SMTP.IPMAP.TAB.</p>

</dd>
<dt id="CustomSMTPMessage">[CustomSMTPMessage]</dt>
<dd>

<p>Set this to the message that you want to follow the standard SMTP error response sent by XMail, as in (one line, remember the =&gt;):</p>

<pre><code> &quot;Please open http://www.xmailserver.test/smtp_errors.html to get=&gt;
    more information about this error&quot;</code></pre>

<p>Please be aware the RFC821 fix the maximum reply line length to 512 bytes.</p>

</dd>
<dt id="SMTP-IpMapDropCode">[SMTP-IpMapDropCode]</dt>
<dd>

<p>Set the drop code for IPs blocked by the SMTP.IPMAP.TAB file:</p>

<dl>

<dt id="pod11">&#39;1&#39;</dt>
<dd>

<p>the connection is dropped soon</p>

</dd>
<dt id="pod01">&quot;0&quot;</dt>
<dd>

<p>the connection is kept alive but only authenticated users can send mail</p>

</dd>
<dt id="S1">&#39;-S&#39;</dt>
<dd>

<p>the peer can send messages but a delay of S seconds is introduced between commands</p>

</dd>
</dl>

</dd>
<dt id="AllowSmtpVRFY">[AllowSmtpVRFY]</dt>
<dd>

<p>Enable the use of VRFY SMTP command. This flag may be forced by SMTP authentication.</p>

</dd>
<dt id="AllowSmtpETRN">[AllowSmtpETRN]</dt>
<dd>

<p>Enable the use of ETRN SMTP command. This flag may be forced by SMTP authentication.</p>

</dd>
<dt id="SmtpMinDiskSpace">[SmtpMinDiskSpace]</dt>
<dd>

<p>Minimum disk space (in Kb) that is requested before accepting an SMTP connection.</p>

</dd>
<dt id="SmtpMinVirtMemSpace">[SmtpMinVirtMemSpace]</dt>
<dd>

<p>Minimum virtual memory (in Kb) that is requested before accepting an SMTP connection.</p>

</dd>
<dt id="Pop3MinVirtMemSpace">[Pop3MinVirtMemSpace]</dt>
<dd>

<p>Minimum virtual memory (in Kb) that is requested before accepting a POP3 connection.</p>

</dd>
<dt id="Pop3SyncErrorAccount">[Pop3SyncErrorAccount]</dt>
<dd>

<p>This defines the email account (MUST be handled locally) that receives all fetched email that XMail has not been able to deliver.</p>

</dd>
<dt id="EnableAuthSMTP-POP3">[EnableAuthSMTP-POP3]</dt>
<dd>

<p>Enable SMTP after POP3 authentication (default on).</p>

</dd>
<dt id="MaxMessageSize">[MaxMessageSize]</dt>
<dd>

<p>Set the maximum message size in Kb that is possible to send through the server.</p>

</dd>
<dt id="DefaultSmtpPerms">[DefaultSmtpPerms]</dt>
<dd>

<p>This list SMTP permissions assigned to users looked up inside <a href="#MAILUSERS.TAB">&quot;MAILUSERS.TAB&quot;</a> during SMTP authentication. It also defines the permissions for users authenticated with SMTP after POP3.</p>

</dd>
<dt id="CustMapsList">[CustMapsList]</dt>
<dd>

<p>This is a list a user can use to set custom maps checking. The list has the given (strict) format:</p>

<p>maps-root:code,maps-root:code...</p>

<p>Where maps-root is the root for the DNS query (i.e. dialups.mail-abuse.org.) and the code can be:</p>

<dl>

<dt id="pod12">&#39;1&#39;</dt>
<dd>

<p>the connection is dropped soon</p>

</dd>
<dt id="pod02">&quot;0&quot;</dt>
<dd>

<p>the connection is kept alive but only authenticated users can send mail</p>

</dd>
<dt id="S2">&#39;-S&#39;</dt>
<dd>

<p>the peer can send messages but a delay of S seconds is introduced between commands</p>

</dd>
</dl>

</dd>
<dt id="SMTP-RDNSCheck">[SMTP-RDNSCheck]</dt>
<dd>

<p>Indicate if XMail must do an RDNS lookup before accepting a incoming SMTP connection. If 0, the check is not performed; if 1 and the check fails, the user receives a &#39;server use forbidden&#39; at MAIL_FROM time; if -S (S &gt; 0) and the check fails, a delay of S seconds between SMTP commands is used to prevent massive spamming.</p>

<p>SMTP authentication overrides the denial set by this option by giving authenticated users the ability to access the server from &#39;mapped&#39; IPs.</p>

</dd>
<dt id="SmartDNSHost">[SmartDNSHost]</dt>
<dd>

<p>Setup a list of smart DNS hosts to which are directed DNS queries with recursion bit set to true. Such DNS hosts must support DNS recursion in queries. The format is:</p>

<pre><code> dns.home.bogus.net:tcp,192.168.1.1:udp,...</code></pre>

</dd>
<dt id="DisableEmitAuthUser">[DisableEmitAuthUser]</dt>
<dd>

<p>Enable/disable the emission the the &#39;X-AuthUser:&#39; mail header for authenticated users. Valid values are &quot;0&quot; or &#39;1&#39;, default is &quot;0&quot; (emission enabled).</p>

</dd>
<dt id="SmtpGwConfig">[SmtpGwConfig]</dt>
<dd>

<p>Sets global SMTP gateway options. Those can be overridden by specific gateway options. See [<a href="#SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</a>] for information.</p>

</dd>
<dt id="Pop3LogPasswd">[Pop3LogPasswd]</dt>
<dd>

<p>Control if POP3 passwords are logged into the POP3 log file. Set to &quot;0&quot; to disable password logging, set to &quot;1&quot; to enable logging of failed logins, and the to &quot;2&quot; to always enable password logging. Default is &quot;0&quot;.</p>

</dd>
<dt id="SmtpNoTLSAuths">[SmtpNoTLSAuths]</dt>
<dd>

<p>Lists a comma-separated sequence of SMTP authentications that are allowed while the connections is in non-TLS mode (clear text). Do not set this variable if you do not want to impose any restriction, or set it to the empty string if you do not want any authentication method to be allowed in clear-text mode.</p>

</dd>
<dt id="EnableCTRL-TLS">[EnableCTRL-TLS]</dt>
<dd>

<p>Enable CTRL TLS negotiation (default &quot;1&quot;).</p>

</dd>
<dt id="EnablePOP3-TLS">[EnablePOP3-TLS]</dt>
<dd>

<p>Enable POP3 TLS (STLS) negotiation (default &quot;1&quot;).</p>

</dd>
<dt id="EnableSMTP-TLS">[EnableSMTP-TLS]</dt>
<dd>

<p>Enable SMTP TLS (STARTTLS) negotiation (default &quot;1&quot;).</p>

</dd>
<dt id="SSLUseCertsFile">[SSLUseCertsFile]</dt>
<dd>

</dd>
<dt id="SSLUseCertsDir">[SSLUseCertsDir]</dt>
<dd>

</dd>
<dt id="SSLWantVerify">[SSLWantVerify]</dt>
<dd>

</dd>
<dt id="SSLAllowSelfSigned">[SSLAllowSelfSigned]</dt>
<dd>

</dd>
<dt id="SSLWantCert">[SSLWantCert]</dt>
<dd>

</dd>
<dt id="SSLMaxCertsDepth">[SSLMaxCertsDepth]</dt>
<dd>

<p>See [<a href="#SSL-CONFIGURATION">SSL CONFIGURATION</a>] for information.</p>

</dd>
<dt id="SmtpConfig">[SmtpConfig]</dt>
<dd>

<p>Default SMTP server config loaded if specific server IP[,PORT] config is not found.</p>

</dd>
<dt id="SmtpConfig-IP-SmtpConfig-IP-PORT">[SmtpConfig-IP | SmtpConfig-IP,PORT]</dt>
<dd>

<p>Specific IP or IP,PORT SMTP server config. Examples:</p>

<pre><code> &quot;SmtpConfig-192.168.1.123&quot; &quot;...&quot;
 &quot;SmtpConfig-192.168.1.17,1025&quot; &quot;...&quot;</code></pre>

<p>The variable value is a comma separated sequence of configuration tokens whose meaning is:</p>

<dl>

<dt id="MailAuth">MailAuth</dt>
<dd>

<p>authentication required to send mail to the server. Please note that by setting this value everything requires authentication, even for sending to local domains, and this is probably not what you want. The &quot;mail-auth&quot; is also synonym of &quot;MailAuth&quot;.</p>

</dd>
<dt id="WantTLS">WantTLS</dt>
<dd>

<p>TLS connection needed to talk to this server. This is either done by issuing a STARTTLS command over a standard SMTP session, or by using an SMTPS port</p>

</dd>
</dl>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="MESSAGE-FILTERS">MESSAGE FILTERS</h1>

<p>This feature offers a way to filter messages by providing the ability to execute external programs, such as scripts or real executables. These &#39;filters&#39; may examine and/or modify messages and inform XMail of their actions with a return value.</p>

<p>This feature offers the ability to inspect and modify messages, giving a way to reject messages based on content, alter messages (address rewriting) and so on.</p>

<p>If this filters returns &#39;<b>4, 5 or 6</b>&#39; the message is rejected and is stopped in its travel. If the filter modifies the message it must return &#39;<b>7</b>&#39;.</p>

<p>Additional flags are allowed to be returned to XMail as a result of filter processing by adding the flags value to the exits code above listed. The currently defined flags are :</p>

<dl>

<dt id="pod16">&#39;16&#39;</dt>
<dd>

<p>Stop selected filter list processing.</p>

</dd>
</dl>

<p>Filter flags are additive and if more than one flag need to be specified, their values must be added together. If a filter &quot;raw&quot; exit code is <b>RC</b> and the filter needs to return extra flags <b>FILTER-SUM</b>, the final return code <b>FRC</b> must be :</p>

<p><b>FRC</b> = <b>RC</b> + <b>FILTER-SUM</b></p>

<p>Example. Suppose a filter modified the message and hence needs to return <b>7</b> as return code. Suppose also that a filter wants to block the filter selection list processing by specifying a flags value of <b>16</b>, the value to be returned will be :</p>

<p><b>FRC</b> = <b>7</b> + <b>16</b> = <b>23</b></p>

<p>Filter selection is driven by two files &#39;<b>FILTERS.IN.TAB</b>&#39; and &#39;<b>FILTERS.OUT.TAB</b>&#39; located inside the $MAIL_ROOT/ directory and that have the following format:</p>

<pre><code> &quot;sender&quot;[TAB]&quot;recipient&quot;[TAB]&quot;remote-addr&quot;[TAB]&quot;local-addr&quot;[TAB]&quot;filename&quot;[NEWLINE]</code></pre>

<p>For example:</p>

<pre><code> &quot;*@bad-domain.com&quot; &quot;*&quot; &quot;0.0.0.0/0&quot; &quot;0.0.0.0/0&quot; &quot;av-filter.tab&quot;
 &quot;*&quot; &quot;clean@purified.net&quot; &quot;0.0.0.0/0&quot; &quot;0.0.0.0/0&quot; &quot;spam-block.tab&quot;
 &quot;*&quot; &quot;*&quot; &quot;192.168.1.0/24&quot; &quot;0.0.0.0/0&quot; &quot;archive.tab&quot;</code></pre>

<p>where the file &quot;av-filter.tab&quot; must be present inside the $MAIL_ROOT/filters directory. The &quot;sender&quot; and the &quot;recipient&quot; are resolved to the real account when possible. Address selection mask are formed by an IP address (network) plus the number of valid bits inside the network mask. The file &#39;<b>FILTERS.IN.TAB</b>&#39; lists filters that have to be applied to inbound messages (going to local mailboxes) while the file &#39;<b>FILTERS.OUT.TAB</b>&#39; lists filters that have to be applied to outbound messages (delivered remotely). All four (sender+recipient+remote-addr+local-addr) selection fields must have a match in order &quot;filename&quot; to be evaluated. The syntax of the filter file is:</p>

<pre><code> &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>or:</p>

<pre><code> &quot;!flags&quot;[TAB]&quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>Each file may contain multiple commands, that will be executed in strictly sequential order. The first command that will trigger a rejection code will make the filtering process to end. The &#39;<b>flags</b>&#39; parameter is a comma-separated list of flags that drives the filter execution. The syntax of each flag is either FLAG or FLAG=VAL. Currently supported flags are:</p>

<dl>

<dt id="aex">aex</dt>
<dd>

<p>exclude filter execution in case of authenticated sender</p>

</dd>
<dt id="wlex">wlex</dt>
<dd>

<p>exclude filter execution in case the client IP is white-listed inside the SMTP.IPPROP.TAB file. This flag works only for SMTP filters.</p>

</dd>
<dt id="timeo">timeo</dt>
<dd>

<p>sets the timeout value for this filter execution</p>

</dd>
</dl>

<p>Each argument can be a macro also (see [<a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a>]):</p>

<dl>

<dt id="FROM2">FROM</dt>
<dd>

<p>the sender of the message</p>

</dd>
<dt id="RFROM">RFROM</dt>
<dd>

<p>the sender of the message resolved to the real account, when possible (alias resolution)</p>

</dd>
<dt id="RCPT2">RCPT</dt>
<dd>

<p>the target of the message</p>

</dd>
<dt id="RRCPT1">RRCPT</dt>
<dd>

<p>the target of the message resolved to the real account, when possible (alias resolution)</p>

</dd>
<dt id="REMOTEADDR">REMOTEADDR</dt>
<dd>

<p>remote IP address and port of the sender</p>

</dd>
<dt id="LOCALADDR">LOCALADDR</dt>
<dd>

<p>local IP address and port where the message has been accepted</p>

</dd>
<dt id="FILE2">FILE</dt>
<dd>

<p>the message file path (the external command may modify the file if it returns &#39;<b>7</b>&#39; as command exit value.)</p>

</dd>
<dt id="MSGID2">MSGID</dt>
<dd>

<p>with the (XMail unique) message id</p>

</dd>
<dt id="MSGREF2">MSGREF</dt>
<dd>

<p>the reference SMTP message id</p>

</dd>
<dt id="USERAUTH2">USERAUTH</dt>
<dd>

<p>name of the SMTP authenticated user, or &quot;-&quot; if no authentication has been supplied</p>

</dd>
</dl>

<p>Here &#39;<b>command</b>&#39; is the name of an external program that processes the message and returns its processing result. If it returns &#39;<b>6</b>&#39; the message is rejected and a notification message is sent to the sender. By returning &#39;<b>5</b>&#39; the message is rejected without notification. While returning &#39;<b>4</b>&#39; the message is rejected without notification and without being frozen (a &#39;<b>5</b>&#39; response could lead to a frozen message if the <a href="#SERVER.TAB">&quot;SERVER.TAB&quot;</a> configuration enables this). If all filters return values different from &#39;<b>6, 5 and 4</b>&#39; the message continues its trip. The filter command may also modify the file (AV scanning, content filter, message rewriting, etc) by returning &#39;<b>7</b>&#39;. The filter &#39;<b>MUST</b>&#39; return &#39;<b>7</b>&#39; in case it modifies the message. If the filter changes the message file it &#39;<b>MUST</b>&#39; keep the message structure and it &#39;<b>MUST</b>&#39; terminate all line with &lt;CR&gt;&lt;LF&gt;. The filter has also the ability to return a one-line custom return message by creating a file named $(FILE).rej holding the message in the very first line. This file should be created &#39;<b>ONLY</b>&#39; when the filter returns a rejection code (&#39;<b>6, 5 and 4</b>&#39;)and &#39;<b>NEVER</b>&#39; in case of passthrough code (&#39;<b>7</b>&#39;) or modify code.</p>

<p>The spool files has this structure:</p>

<pre><code> Info Data           [ 1th line ]
 SmtpDomain          [ 2nd line ]
 SmtpMessageID       [ 3rd line ]
 MAIL FROM:&lt;...&gt;     [ 4th line ]
 RCPT TO:&lt;...&gt;       [ 5th line ]
 &lt;&lt;MAIL-DATA&gt;&gt;       [ 6th line ]
 ...</code></pre>

<p>After the &#39;<b>&lt;&lt;MAIL-DATA&gt;&gt;</b>&#39; tag (5th line) the message follows. The message is composed of a headers section and, after the first empty line, the message body. The format of the &quot;Info Data&quot; line is:</p>

<pre><code> [ClientIP]:ClientPort;[ServerIP]:ServerPort;Time</code></pre>

<p>&#39;<b>EXTREME</b>&#39; care must be used when modifying the message because the filter will be working on the real message, and a badly reformatted file will lead to message loss. The spool file header (any data before &lt;&lt;MAIL-DATA&gt;&gt;) &#39;<b>MUST</b>&#39; be preserved as is by the filter in case of message rewrite happens.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SMTP-MESSAGE-FILTERS">SMTP MESSAGE FILTERS</h1>

<p>Besides having the ability to perform off-line message filtering, XMail gives the user the power to run filters during the SMTP session. Three files drive the SMTP on-line filtering, and these are &#39;<b>FILTERS.POST-RCPT.TAB</b>&#39;, &#39;<b>FILTERS.PRE-DATA.TAB</b>&#39; and &#39;<b>FILTERS.POST-DATA.TAB</b>&#39;. The file &#39;<b>FILTERS.POST-RCPT.TAB</b>&#39;, contains one or more commands to be executed after the remote SMTP client sends the RCPT_TO command(s), and before XMail sends the response to the command. The file &#39;<b>FILTERS.PRE-DATA.TAB</b>&#39; contains one or more commands to be executed after the remote SMTP client sends the DATA command, and before XMail sends the response to the command. Using such filters, the user can tell XMail if or if not accept the following transaction and, in case of rejection, the user is also allowed to specify a custom message to be sent to the remote SMTP client. The file &#39;<b>FILTERS.POST-DATA.TAB</b>&#39; contains one or more commands to be executed after XMail received the whole client DATA, and before XMail sends the final response to the DATA command (final messages ack). The files &#39;<b>FILTERS.POST-RCPT.TAB</b>&#39;, &#39;<b>FILTERS.PRE-DATA.TAB</b>&#39; and &#39;<b>FILTERS.POST-DATA.TAB</b>&#39; contains zero or more lines with the following format:</p>

<pre><code> &quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>or:</p>

<pre><code> &quot;!flags&quot;[TAB]&quot;command&quot;[TAB]&quot;arg-or-macro&quot;[TAB]...[NEWLINE]</code></pre>

<p>Each file may contain multiple commands, that will be executed in strictly sequential order. The first command that will trigger a rejection code will make the filtering process to end. The &#39;<b>flags</b>&#39; parameter is a comma-separated list of flags that drives the filter execution. The syntax of each flag is either FLAG or FLAG=VAL. Currently supported flags are:</p>

<dl>

<dt id="aex1">aex</dt>
<dd>

<p>exclude filter execution in case of authenticated sender</p>

</dd>
<dt id="wlex1">wlex</dt>
<dd>

<p>exclude filter execution in case the client IP is white-listed inside the SMTP.IPPROP.TAB file.</p>

</dd>
</dl>

<p>Each argument can be a macro also (see [<a href="#MACRO-SUBSTITUTION">MACRO SUBSTITUTION</a>]):</p>

<dl>

<dt id="FILE3">FILE</dt>
<dd>

<p>message file path</p>

</dd>
<dt id="USERAUTH3">USERAUTH</dt>
<dd>

<p>name of the SMTP authenticated user, or &quot;-&quot; if no authentication has been supplied</p>

</dd>
<dt id="REMOTEADDR1">REMOTEADDR</dt>
<dd>

<p>remote IP address and port of the sender</p>

</dd>
<dt id="LOCALADDR1">LOCALADDR</dt>
<dd>

<p>local IP address and port where the message has been accepted</p>

</dd>
<dt id="FROM3">FROM</dt>
<dd>

<p>message sender address</p>

</dd>
<dt id="CRCPT">CRCPT</dt>
<dd>

<p>last recipient submitted by the client. For post-rcpt filters, this will be used as to-validate recipient</p>

</dd>
<dt id="RRCPT2">RRCPT</dt>
<dd>

<p>last recipient submitted by the client, translated to the real account (in case of aliases)</p>

</dd>
</dl>

<p>Filter commands have the ability to inspect and modify the content of the message (or info) file. The exit code of commands executed by XMail are used to tell XMail the action that has to be performed as a consequence of the filter. The exit code is composed by a raw exit code and additional flags. Currently defined flags are:</p>

<dl>

<dt id="pod161">&#39;16&#39;</dt>
<dd>

<p>Stop selected filter list processing.</p>

</dd>
</dl>

<p>Currently defined raw exit codes are:</p>

<dl>

<dt id="pod31">&#39;3&#39;</dt>
<dd>

<p>Reject the message.</p>

</dd>
</dl>

<p>Any other exit codes will make XMail to accept the message, and can be used also when changing the content of the $(FILE) file. &#39;<b>EXTREME</b>&#39; care must be used when changing the $(FILE) file, since XMail expect the file format to be correct. Also, it is important to preserve the &lt;CR&gt;&lt;LF&gt; line termination of the file itself. When rejecting the message, the filter command has the ability to specify the SMTP status code that XMail will send to the remote SMTP client, by creating a file named $(FILE).rej containing the message in the very first line. Such file will be automatically removed by XMail. The data passed to filter commands inside $(FILE) varies depending if the command is listed inside &#39;<b>FILTERS.POST-RCPT.TAB</b>&#39;, &#39;<b>FILTERS.PRE-DATA.TAB</b>&#39; or inside &#39;<b>FILTERS.POST-DATA.TAB</b>&#39;. Commands listed inside &#39;<b>FILTERS.POST-RCPT.TAB</b>&#39; and &#39;<b>FILTERS.PRE-DATA.TAB</b>&#39; will receive the following data stored inside $(FILE):</p>

<pre><code> Info Data           [ 1th line ]
 SmtpDomain          [ 2nd line ]
 SmtpMessageID       [ 3rd line ]
 MAIL FROM:&lt;...&gt;     [ 4th line ]
 RCPT TO:&lt;...&gt; {...} [ 5th line ]
 ...</code></pre>

<p>The file can have one or more &quot;RCPT TO&quot; lines. The format of the &quot;Info Data&quot; line is:</p>

<pre><code> ClientDomain;[ClientIP]:ClientPort;ServerDomain;[ServerIP]:ServerPort;Time;Logo</code></pre>

<p>Note that in case of &#39;<b>FILTERS.POST-RCPT.TAB</b>&#39;, the $(FILE) data does not yet contain the current recipient to be validated. This needs to be fetched and passed to the external program using the $(CRCPT) macro (or $(RRCPT)). Commands listed inside &#39;<b>FILTERS.POST-DATA.TAB</b>&#39; will receive the following data stored inside $(FILE):</p>

<pre><code> Info Data           [ 1th line ]
 SmtpDomain          [ 2nd line ]
 SmtpMessageID       [ 3rd line ]
 MAIL FROM:&lt;...&gt;     [ 4th line ]
 RCPT TO:&lt;...&gt; {...} [ 5th line ]
 ...
 &lt;&lt;MAIL-DATA&gt;&gt;
 ...</code></pre>

<p>After the &#39;<b>&lt;&lt;MAIL-DATA&gt;&gt;</b>&#39; tag the message follows. The message is composed of a headers section and, after the first empty line, the message body. The format of the RCPT line is:</p>

<pre><code> RCPT TO:&lt;address&gt; {ra=real-address}</code></pre>

<p>where &quot;real-address&quot; is the &quot;address&quot; after it has been translated (if aliases applies) to the real local address. Otherwise it holds the same value of &quot;address&quot;. In case one or more SMTP filter operations are not needed, avoid to create zero sized files altogether, since this will result in faster processing.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="USER.TAB-VARIABLES">USER.TAB VARIABLES</h1>

<p>The following variables are for use in the <a href="#USER.TAB">&quot;USER.TAB&quot;</a> configuration file.</p>

<dl>

<dt id="RealName">[RealName]</dt>
<dd>

<p>Full user name, i.e.:</p>

<pre><code> &quot;RealName&quot;  &quot;Davide Libenzi&quot;</code></pre>

</dd>
<dt id="HomePage">[HomePage]</dt>
<dd>

<p>User home page, i.e.:</p>

<pre><code> &quot;HomePage&quot;  &quot;http://www.xmailserver.org/davide.html&quot;</code></pre>

</dd>
<dt id="MaxMBSize">[MaxMBSize]</dt>
<dd>

<p>Max user mailbox size in Kb, i.e.:</p>

<pre><code> &quot;MaxMBSize&quot; &quot;30000&quot;</code></pre>

</dd>
<dt id="ClosedML">[ClosedML]</dt>
<dd>

<p>Specify if the mailing list is closed only to subscribed users, i.e.:</p>

<pre><code> &quot;ClosedML&quot;  &quot;1&quot;</code></pre>

</dd>
<dt id="ListSender">[ListSender]</dt>
<dd>

<p>Specify the mailing list sender or administrator:</p>

<pre><code> &quot;ListSender&quot;    &quot;ml-admin@xmailserver.org&quot;</code></pre>

<p>This variable should be set to avoid delivery error notifications to reach the original message senders.</p>

</dd>
<dt id="SmtpPerms">[SmtpPerms]</dt>
<dd>

<p>User SMTP permissions (see SMTPAUTH.TAB for info).</p>

</dd>
<dt id="ReceiveEnable">[ReceiveEnable]</dt>
<dd>

<p>Set to &#39;1&#39; if the account can receive email, &#39;0&#39; if you want to disable the account from receiving messages.</p>

</dd>
<dt id="PopEnable">[PopEnable]</dt>
<dd>

<p>Set to &#39;1&#39; if you want to enable the account to fetch POP3 messages, &#39;0&#39; otherwise.</p>

</dd>
<dt id="UseReplyTo">[UseReplyTo]</dt>
<dd>

<p>Enable/Disable the emission of the Reply-To: header for mailing list&#39;s messages (default 1).</p>

</dd>
<dt id="MaxMessageSize1">[MaxMessageSize]</dt>
<dd>

<p>Set the maximum message size (in Kb) that the user is able to send through the server. Overrides the SERVER.TAB variable.</p>

</dd>
<dt id="DisableEmitAuthUser1">[DisableEmitAuthUser]</dt>
<dd>

<p>Enable/disable the emission the the &#39;X-AuthUser:&#39; mail header for authenticated users. Valid values are &#39;0&#39; or &#39;1&#39;, default is &#39;0&#39; (emission enabled). This variable overrides the SERVER.TAB one when present.</p>

</dd>
<dt id="Pop3ScanCur">[Pop3ScanCur]</dt>
<dd>

<p>In case of Maildir mailbox structure, scan the &quot;cur&quot; directory during POP3 message list build. Set to &quot;0&quot; to disable &quot;cur&quot; directory scanning, or to &quot;1&quot; to enable it.</p>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="MAIL-ROUTING-THROUGH-ADDRESSES">MAIL ROUTING THROUGH ADDRESSES</h1>

<p>A full implementation of SMTP protocol allows the ability to perform mail routing bypassing DNS MX records by means of setting, in a ruled way, the &#39;RCPT TO: &lt;&gt;&#39; request. A mail from &#39;<b>xuser@hostz</b>&#39; directed to &#39;<b>@hosta,@hostb:foouser@hostc</b>&#39; is received by &#39;<b>@hosta</b>&#39; then sent to &#39;<b>@hostb</b>&#39; using &#39;<b>MAIL FROM: &lt;@hosta:xuser@hostz</b>&gt;&#39; and &#39;<b>RCPT TO: &lt;@hostb:foouser@hostc</b>&gt;&#39;. The message is then sent to &#39;<b>@&#39;hostc</b> using &#39;<b>MAIL FROM: &lt;@hostb,@hosta:xuser@hostz</b>&gt;&#39; and &#39;<b>RCPT TO: &lt;foouser@hostc</b>&gt;&#39;.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="XMAIL-SPOOL-DESIGN">XMAIL SPOOL DESIGN</h1>

<p>The new spool filesystem tree format has been designed to enable XMail to handle very large queues. Instead of having a single spool directory (like versions older than 0.61) a two layer deep splitting has been introduced so that its structure is:</p>

<pre><code> 0   &lt;dir&gt;
   0   &lt;dir&gt;
     mess    &lt;dir&gt;
     rsnd    &lt;dir&gt;
     info    &lt;dir&gt;
     temp    &lt;dir&gt;
     slog    &lt;dir&gt;
     cust    &lt;dir&gt;
     froz    &lt;dir&gt;
   ...
 ...</code></pre>

<p>When XMail needs to create a new spool file a spool path is chosen in a random way and a new file with the format:</p>

<pre><code> mstime.tid.seq.hostname</code></pre>

<p>is created inside the &#39;<b>temp</b>&#39; subdirectory. When the spool file is ready to be committed, it&#39;s moved into the &#39;<b>mess</b>&#39; subdirectory that holds newer spool files. If XMail fails sending a new message (the ones in mess subdirectory) it creates a log file (with the same name of the message file) inside the &#39;<b>slog</b>&#39; subdirectory and move the file from &#39;<b>mess</b>&#39; to &#39;<b>rsnd</b>&#39;. During the message sending the message itself is locked by creating a file inside the &#39;<b>lock</b>&#39; subdirectory (with the same name of the message file). If the message has permanent delivery errors or is expired and if the option &#39;<b>RemoveSpoolErrors</b>&#39; of the &#39;<b>SERVER.TAB</b>&#39; file is off, the message file is moved into the &#39;<b>froz</b>&#39; subdirectory.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SMTP-GATEWAY-CONFIGURATION">SMTP GATEWAY CONFIGURATION</h1>

<p>An SMTP gateway definition inside XMail can be followed by a set of configuration options, that are in the form of a comma-separated VAR=VAL or FLAG definitions. Currently defined options are:</p>

<dl>

<dt id="NeedTLS">NeedTLS</dt>
<dd>

<p>If set to 1, instruct XMail to try to establish a TLS session with the remote host (by the means of a STARTTLS SMTP command). If set to 2, XMail will try to establish a TLS session, but it will fail if not able to do so (the remote server does not support STARTTLS, or reject our attempt to negotiate the TLS link).</p>

</dd>
<dt id="OutBind1">OutBind</dt>
<dd>

<p>Sets the IP address of the network interface that should be used when connecting to the remote host. This configuration should be used carefully, because XMail will fail if the selected IP of the interface does not have a route to the remote host using such IP.</p>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SSL-CONFIGURATION">SSL CONFIGURATION</h1>

<p>XMail uses to identify itself during SSL negotiations, by the mean of the two files &#39;<b>server.cert</b>&#39; and &#39;<b>server.key</b>&#39;. These files &#39;<b>MUST</b>&#39; be available inside the &#39;<b>MAIL_ROOT</b>&#39; directory. Both are in PEM format, and one represent the server certificate file/chain (&#39;<b>server.cert</b>&#39;) while the other represent the server private key file (&#39;<b>server.key</b>&#39;). XMail uses the OpenSSL libraries for its SSL operations. <a href="http://www.openssl.org/docs/HOWTO/certificates.txt">http://www.openssl.org/docs/HOWTO/certificates.txt</a> contains examples about how to create certificates to be use by XMail, while <a href="http://www.openssl.org/docs/HOWTO/keys.txt">http://www.openssl.org/docs/HOWTO/keys.txt</a> describes own to generate keys. In order to properly manage your XMail server when using SSL support, you need to have access to the OpenSSL binary. For Unix ports, this is available as a package, whose name varies depending on the distribution. For Windows, pre-built versions of theOpenSSL libraries and binary are supplied inside the &quot;win64ssl&quot; directory of the XMail source package. For example, to create a self-signed certificate, you first have to create a private key with:</p>

<pre><code>  $ openssl genrsa 2048 &gt; server.key</code></pre>

<p>After you have created the private key, you can create you own copy of the self-signed certificate with:</p>

<pre><code>  $ openssl req -new -x509 -key server.key -out server.cert

  C:&gt; openssl req -new -x509 -key server.key -out server.cert -config openssl.cnf</code></pre>

<p>Remeber that the Common Name (CN) that you supply to the OpenSSL binary, is the fully qualified host name that answers to the IP where your XMail server is listening. If you want to have a certificate signed by an authority, you need to generate a certificate request file:</p>

<pre><code>  $ openssl req -new -key server.key -out cert.csr

  C:&gt; openssl req -new -key server.key -out cert.csr -config openssl.cnf</code></pre>

<p>The &#39;<b>openssl.cnf</b>&#39; file is supplied inside the Xmail&#39;s Windows binary package, and inside the &#39;<b>win64ssl\conf</b>&#39; directory of the source package. The &#39;<b>cert.csr</b>&#39; file needs then to be submitted to the certificate authority in order to obtain a root-signed certificate file (that will be your &#39;<b>server.cert</b>&#39;). The behaviour of the XMail SSL module is controlled by a few &#39;<b>SERVER.TAB</b>&#39; variables:</p>

<dl>

<dt id="SSLWantVerify1">[SSLWantVerify]</dt>
<dd>

<p>Tells the SSL link negotiation code to verify the remote peer certificate. If this is enabled, you need to use either <b>SSLUseCertsFile</b> or <b>SSLUseCertsDir</b> to provide a set of valid root certificates. You can also add your own certificates in the set, in order to provide access to your servers by clients using certificates signed by you.</p>

</dd>
<dt id="SSLWantCert1">[SSLWantCert]</dt>
<dd>

<p>Tells the SSL link negotiation code to fail if the remote peer does not supply a certificate.</p>

</dd>
<dt id="SSLAllowSelfSigned1">[SSLAllowSelfSigned]</dt>
<dd>

<p>Allows self-signed certificates supplied by remote peers.</p>

</dd>
<dt id="SSLMaxCertsDepth1">[SSLMaxCertsDepth]</dt>
<dd>

<p>Set the maximum certificate chain depth for the verification process.</p>

</dd>
<dt id="SSLUseCertsFile1">[SSLUseCertsFile]</dt>
<dd>

<p>When using <b>SSLWantVerify</b>, the SSL code will verify the peer certificate using standard SSL certificate chain verification rules. It is possible to supply to XMail an extra list of valid certificates, by filling up a &#39;<b>CERTS.PEM</b>&#39; file and setting <b>SSLUseCertsFile</b> to 1. The &#39;<b>CERTS.PEM</b>&#39; is a concatenation of certificates in PEM format.</p>

</dd>
<dt id="SSLUseCertsDir1">[SSLUseCertsDir]</dt>
<dd>

<p>In the same way as <b>SSLUseCertsFile</b> does, setting <b>SSLUseCertsDir</b> to 1 enables the usage of extra valid certificates stored inside the &#39;<b>CERTS</b>&#39; XMail sub-directory. The &#39;<b>CERTS</b>&#39; contains hashed file names that are created by feeding the directory path to the &#39;<b>c_rehash</b>&#39; OpenSSL Perl script (a Windows-friendly version of &#39;<b>c_rehash</b>&#39;, named &#39;<b>c_rehash.pl</b>&#39; is contained inside the &#39;<b>win64ssl\bin</b>&#39; subdirectory of the source package). Unix users will find proper CA certificates inside the standard install paths of OpenSSL, while Windows users will find them inside the &#39;<b>win64ssl\certs</b>&#39; subdirectory of the source package. To use &#39;<b>c_rehash</b>&#39; you need to have the OpenSSL binaries (executable and shared libraries) correctly installed in your system, and the executable reachable from your <b>PATH</b>. Then you simply run it by passing the path to the PEM certificates directory (&#39;<b>CERTS</b>&#39;). The &#39;<b>c_rehash</b>&#39; script will call the OpenSSL binary and will generated hashed file names (that are either symlinks or copies) that point/replicate the mapped certificate.</p>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SMTP-COMMANDS">SMTP COMMANDS</h1>

<p>These are commands understood by ESMTP server:</p>

<dl>

<dt id="MAIL-FROM">MAIL FROM:&lt;&gt;</dt>
<dd>

</dd>
<dt id="RCPT-TO">RCPT TO:&lt;&gt;</dt>
<dd>

</dd>
<dt id="DATA">DATA</dt>
<dd>

</dd>
<dt id="HELO">HELO</dt>
<dd>

</dd>
<dt id="EHLO">EHLO</dt>
<dd>

</dd>
<dt id="STARTTLS">STARTTLS</dt>
<dd>

</dd>
<dt id="AUTH1">AUTH</dt>
<dd>

</dd>
<dt id="RSET">RSET</dt>
<dd>

</dd>
<dt id="VRFY">VRFY</dt>
<dd>

</dd>
<dt id="ETRN">ETRN</dt>
<dd>

</dd>
<dt id="NOOP">NOOP</dt>
<dd>

</dd>
<dt id="HELP">HELP</dt>
<dd>

</dd>
<dt id="QUIT">QUIT</dt>
<dd>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="POP3-COMMANDS">POP3 COMMANDS</h1>

<p>These are commands understood by POP3 server:</p>

<dl>

<dt id="USER2">USER</dt>
<dd>

</dd>
<dt id="PASS1">PASS</dt>
<dd>

</dd>
<dt id="CAPA">CAPA</dt>
<dd>

</dd>
<dt id="STLS1">STLS</dt>
<dd>

</dd>
<dt id="APOP1">APOP</dt>
<dd>

</dd>
<dt id="STAT">STAT</dt>
<dd>

</dd>
<dt id="LIST">LIST</dt>
<dd>

</dd>
<dt id="UIDL">UIDL</dt>
<dd>

</dd>
<dt id="QUIT1">QUIT</dt>
<dd>

</dd>
<dt id="RETR">RETR</dt>
<dd>

</dd>
<dt id="TOP">TOP</dt>
<dd>

</dd>
<dt id="DELE">DELE</dt>
<dd>

</dd>
<dt id="NOOP1">NOOP</dt>
<dd>

</dd>
<dt id="LAST">LAST</dt>
<dd>

</dd>
<dt id="RSET1">RSET</dt>
<dd>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="COMMAND-LINE">COMMAND LINE</h1>

<p>Most of XMail configuration settings are command line tunables. These are command line switches organized by server.</p>

<dl>

<dt id="XMAIL">[XMAIL]</dt>
<dd>

<dl>

<dt id="Ms-pathname">-Ms pathname</dt>
<dd>

<p>Mail root path (also settable with MAIL_ROOT environment).</p>

</dd>
<dt id="Md">-Md</dt>
<dd>

<p>Activate debug (verbose) mode.</p>

</dd>
<dt id="Mr-hours">-Mr hours</dt>
<dd>

<p>Set log rotate hours step.</p>

</dd>
<dt id="Mx-split-level">-Mx split-level</dt>
<dd>

<p>Set the queue split level. The value you set here is rounded to the lower prime number higher or equal than the value you&#39;ve set.</p>

</dd>
<dt id="MR-bytes">-MR bytes</dt>
<dd>

<p>Set the size of the socket&#39;s receive buffer in bytes (rounded up to 1024).</p>

</dd>
<dt id="MS-bytes">-MS bytes</dt>
<dd>

<p>Set the size of the socket&#39;s send buffer in bytes (rounded up to 1024).</p>

</dd>
<dt id="MM">-MM</dt>
<dd>

<p>Setup XMail to use &#39;Maildir&#39; delivery (default on Unix).</p>

</dd>
<dt id="Mm">-Mm</dt>
<dd>

<p>Setup XMail to use &#39;mailbox&#39; delivery (default on Windows).</p>

</dd>
<dt id="MD-ndirs">-MD ndirs</dt>
<dd>

<p>Set the number of subdirectories allocated for the DNS cache files storage ( default 101 ).</p>

</dd>
<dt id="M4">-M4</dt>
<dd>

<p>Use only IPV4 records for host name lookups (default).</p>

</dd>
<dt id="M6">-M6</dt>
<dd>

<p>Use only IPV6 records for host name lookups.</p>

</dd>
<dt id="M5">-M5</dt>
<dd>

<p>Use IPV4 records if present, or IPV6 records otherwise, for host name lookups.</p>

</dd>
<dt id="M7">-M7</dt>
<dd>

<p>Use IPV6 records if present, or IPV4 records otherwise, for host name lookups.</p>

</dd>
</dl>

</dd>
<dt id="POP3">[POP3]</dt>
<dd>

<dl>

<dt id="P">-P-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="P6">-P6</dt>
<dd>

<p>Bind to IPV6 address (in case no -PI option is specified)</p>

</dd>
<dt id="Pp-port">-Pp port</dt>
<dd>

<p>Set POP3 server port (if you change this you must know what you&#39;re doing).</p>

</dd>
<dt id="Pt-timeout">-Pt timeout</dt>
<dd>

<p>Set POP3 session timeout (seconds) after which the server closes. the connection if it does not receive any commands.</p>

</dd>
<dt id="Pl">-Pl</dt>
<dd>

<p>Enable POP3 logging.</p>

</dd>
<dt id="Pw-timeout">-Pw timeout</dt>
<dd>

<p>Set the delay timeout in response to a bad POP3 login. Such time is doubled at the next bad login.</p>

</dd>
<dt id="Ph">-Ph</dt>
<dd>

<p>Hang the connection in bad login response.</p>

</dd>
<dt id="PI-ip-:port">-PI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
<dt id="PX-nthreads">-PX nthreads</dt>
<dd>

<p>Set the maximum number of threads for POP3 server.</p>

</dd>
</dl>

</dd>
<dt id="POP3S1">[POP3S]</dt>
<dd>

<dl>

<dt id="B">-B-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="B6">-B6</dt>
<dd>

<p>Bind to IPV6 address (in case no -BI option is specified)</p>

</dd>
<dt id="Bp-port">-Bp port</dt>
<dd>

<p>Set POP3S server port (if you change this you must know what you&#39;re doing).</p>

</dd>
<dt id="BI-ip-:port">-BI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
</dl>

</dd>
<dt id="SMTP1">[SMTP]</dt>
<dd>

<dl>

<dt id="S3">-S-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="S6">-S6</dt>
<dd>

<p>Bind to IPV6 address (in case no -SI option is specified)</p>

</dd>
<dt id="Sp-port">-Sp port</dt>
<dd>

<p>Set SMTP server port (if you change this you must know what you&#39;re doing).</p>

</dd>
<dt id="St-timeout">-St timeout</dt>
<dd>

<p>Set SMTP session timeout (seconds) after which the server closes the connection if no commands are received.</p>

</dd>
<dt id="Sl">-Sl</dt>
<dd>

<p>Enable SMTP logging.</p>

</dd>
<dt id="SI-ip-:port">-SI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
<dt id="SX-nthreads">-SX nthreads</dt>
<dd>

<p>Set the maximum number of threads for SMTP server.</p>

</dd>
<dt id="Sr-maxrcpts">-Sr maxrcpts</dt>
<dd>

<p>Set the maximum number of recipients for a single SMTP message (default 100).</p>

</dd>
<dt id="Se-nsecs">-Se nsecs</dt>
<dd>

<p>Set the expire timeout for a POP3 authentication IP (default 900).</p>

</dd>
</dl>

</dd>
<dt id="SMTPS">[SMTPS]</dt>
<dd>

<dl>

<dt id="X">-X-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="X6">-X6</dt>
<dd>

<p>Bind to IPV6 address (in case no -XI option is specified)</p>

</dd>
<dt id="Xp-port">-Xp port</dt>
<dd>

<p>Set SMTPS server port (if you change this you must know what you&#39;re doing).</p>

</dd>
<dt id="XI-ip-:port">-XI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
</dl>

</dd>
<dt id="SMAIL">[SMAIL]</dt>
<dd>

<dl>

<dt id="Qn-nthreads.-Default-16-maximum-256">-Qn nthreads. Default 16, maximum 256.</dt>
<dd>

<p>Set the number of mailer threads.</p>

</dd>
<dt id="Qt-timeout">-Qt timeout</dt>
<dd>

<p>Set the time to be wait for a next try after send failure. Default 480.</p>

</dd>
<dt id="Qi-ratio">-Qi ratio</dt>
<dd>

<p>Set the increment ratio of the reschedule time in sending a messages. At every failure in delivery a message, reschedule time T is incremented by (T / ratio), therefore :</p>

<pre><code> T(i) = T(i-1) + T(i-1)/ratio.</code></pre>

<p>If you set this ratio to zero, T remain unchanged over delivery tentatives. Default 16.</p>

</dd>
<dt id="Qr-nretries">-Qr nretries</dt>
<dd>

<p>Set the maximum number of times to try to send the message. Default 32.</p>

</dd>
<dt id="Ql">-Ql</dt>
<dd>

<p>Enable SMAIL logging.</p>

</dd>
<dt id="QT-timeout">-QT timeout</dt>
<dd>

<p>Timeout value for filters commands in seconds. Default 90.</p>

</dd>
<dt id="Qg">-Qg</dt>
<dd>

<p>Enable filter logging.</p>

</dd>
</dl>

</dd>
<dt id="PSYNC">[PSYNC]</dt>
<dd>

<dl>

<dt id="Y">-Y-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="Yi-interval">-Yi interval</dt>
<dd>

<p>Set external POP3 accounts sync interval. Setting this to zero will disable the PSYNC task. Default 120.</p>

</dd>
<dt id="Yt-nthreads">-Yt nthreads</dt>
<dd>

<p>Set the number of POP3 sync threads.</p>

</dd>
<dt id="YT-nsec">-YT nsec</dt>
<dd>

<p>Sets the timeout for POP3 client connections.</p>

</dd>
<dt id="Yl">-Yl</dt>
<dd>

<p>Enable PSYNC logging.</p>

</dd>
</dl>

</dd>
<dt id="FINGER">[FINGER]</dt>
<dd>

<dl>

<dt id="F">-F-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="F6">-F6</dt>
<dd>

<p>Bind to IPV6 address (in case no -FI option is specified)</p>

</dd>
<dt id="Fp-port">-Fp port</dt>
<dd>

<p>Set FINGER server port (if you change this you must know what you&#39;re doing).</p>

</dd>
<dt id="Fl">-Fl</dt>
<dd>

<p>Enable FINGER logging.</p>

</dd>
<dt id="FI-ip-:port">-FI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
</dl>

</dd>
<dt id="CTRL">[CTRL]</dt>
<dd>

<dl>

<dt id="C">-C-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="C6">-C6</dt>
<dd>

<p>Bind to IPV6 address (in case no -CI option is specified)</p>

</dd>
<dt id="Cp-port">-Cp port</dt>
<dd>

<p>Set CTRL server port (if you change this you must know what you&#39;re doing).</p>

</dd>
<dt id="Ct-timeout">-Ct timeout</dt>
<dd>

<p>Set CTRL session timeout (seconds) after which the server closes the connection if no commands are received.</p>

</dd>
<dt id="Cl">-Cl</dt>
<dd>

<p>Enable CTRL logging.</p>

</dd>
<dt id="CI-ip-:port">-CI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
<dt id="CX-nthreads">-CX nthreads</dt>
<dd>

<p>Set the maximum number of threads for CTRL server.</p>

</dd>
</dl>

</dd>
<dt id="CTRLS">[CTRLS]</dt>
<dd>

<dl>

<dt id="W1">-W-</dt>
<dd>

<p>Disable the service.</p>

</dd>
<dt id="W6">-W6</dt>
<dd>

<p>Bind to IPV6 address (in case no -WI option is specified)</p>

</dd>
<dt id="Wp-port">-Wp port</dt>
<dd>

<p>Set CTRLS server port.</p>

</dd>
<dt id="WI-ip-:port">-WI ip[:port]</dt>
<dd>

<p>Bind server to the specified ip address and (optional) port (can be multiple).</p>

</dd>
</dl>

</dd>
<dt id="LMAIL">[LMAIL]</dt>
<dd>

<dl>

<dt id="Ln-nthreads">-Ln nthreads</dt>
<dd>

<p>Set the number of local mailer threads.</p>

</dd>
<dt id="Lt-timeout">-Lt timeout</dt>
<dd>

<p>Set the sleep timeout for LMAIL threads (in seconds, default 2).</p>

</dd>
<dt id="Ll">-Ll</dt>
<dd>

<p>Enable local mail logging.</p>

</dd>
</dl>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="XMAIL-ADMIN-PROTOCOL">XMAIL ADMIN PROTOCOL</h1>

<p>It&#39;s possible to remote admin XMail due to the existence of a &#39;controller server&#39; that runs with XMail and waits for TCP/IP connections on a port (6017 or tunable via a &#39;-Cp nport&#39;) command line option.</p>

<p>Admin protocol details:</p>

<dl>

<dt id="Description"><a href="#Description">&quot;Description&quot;</a></dt>
<dd>

</dd>
<dt id="Adding-a-user"><a href="#Adding-a-user">&quot;Adding a user&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-a-user"><a href="#Deleting-a-user">&quot;Deleting a user&quot;</a></dt>
<dd>

</dd>
<dt id="Changing-a-users-password"><a href="#Changing-a-user-s-password">&quot;Changing a user&#39;s password&quot;</a></dt>
<dd>

</dd>
<dt id="Authenticate-user"><a href="#Authenticate-user">&quot;Authenticate user&quot;</a></dt>
<dd>

</dd>
<dt id="Retrieve-user-statistics"><a href="#Retrieve-user-statistics">&quot;Retrieve user statistics&quot;</a></dt>
<dd>

</dd>
<dt id="Adding-an-alias"><a href="#Adding-an-alias">&quot;Adding an alias&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-an-alias"><a href="#Deleting-an-alias">&quot;Deleting an alias&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-aliases"><a href="#Listing-aliases">&quot;Listing aliases&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-user-vars"><a href="#Listing-user-vars">&quot;Listing user vars&quot;</a></dt>
<dd>

</dd>
<dt id="Setting-user-vars"><a href="#Setting-user-vars">&quot;Setting user vars&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-users"><a href="#Listing-users">&quot;Listing users&quot;</a></dt>
<dd>

</dd>
<dt id="Getting-mailproc.tab-file"><a href="#Getting-mailproc.tab-file">&quot;Getting mailproc.tab file&quot;</a></dt>
<dd>

</dd>
<dt id="Setting-mailproc.tab-file"><a href="#Setting-mailproc.tab-file">&quot;Setting mailproc.tab file&quot;</a></dt>
<dd>

</dd>
<dt id="Adding-a-mailing-list-user"><a href="#Adding-a-mailing-list-user">&quot;Adding a mailing list user&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-a-mailing-list-user"><a href="#Deleting-a-mailing-list-user">&quot;Deleting a mailing list user&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-mailing-list-users"><a href="#Listing-mailing-list-users">&quot;Listing mailing list users&quot;</a></dt>
<dd>

</dd>
<dt id="Adding-a-domain"><a href="#Adding-a-domain">&quot;Adding a domain&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-a-domain"><a href="#Deleting-a-domain">&quot;Deleting a domain&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-handled-domains"><a href="#Listing-handled-domains">&quot;Listing handled domains&quot;</a></dt>
<dd>

</dd>
<dt id="Adding-a-domain-alias"><a href="#Adding-a-domain-alias">&quot;Adding a domain alias&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-a-domain-alias"><a href="#Deleting-a-domain-alias">&quot;Deleting a domain alias&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-alias-domains"><a href="#Listing-alias-domains">&quot;Listing alias domains&quot;</a></dt>
<dd>

</dd>
<dt id="Getting-custom-domain-file"><a href="#Getting-custom-domain-file">&quot;Getting custom domain file&quot;</a></dt>
<dd>

</dd>
<dt id="Setting-custom-domain-file"><a href="#Setting-custom-domain-file">&quot;Setting custom domain file&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-custom-domains"><a href="#Listing-custom-domains">&quot;Listing custom domains&quot;</a></dt>
<dd>

</dd>
<dt id="Adding-a-POP3-external-link"><a href="#Adding-a-POP3-external-link">&quot;Adding a POP3 external link&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-a-POP3-external-link"><a href="#Deleting-a-POP3-external-link">&quot;Deleting a POP3 external link&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-POP3-external-links"><a href="#Listing-POP3-external-links">&quot;Listing POP3 external links&quot;</a></dt>
<dd>

</dd>
<dt id="Enabling-a-POP3-external-link"><a href="#Enabling-a-POP3-external-link">&quot;Enabling a POP3 external link&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-files"><a href="#Listing-files">&quot;Listing files&quot;</a></dt>
<dd>

</dd>
<dt id="Getting-configuration-file"><a href="#Getting-configuration-file">&quot;Getting configuration file&quot;</a></dt>
<dd>

</dd>
<dt id="Setting-configuration-file"><a href="#Setting-configuration-file">&quot;Setting configuration file&quot;</a></dt>
<dd>

</dd>
<dt id="Listing-frozen-messages"><a href="#Listing-frozen-messages">&quot;Listing frozen messages&quot;</a></dt>
<dd>

</dd>
<dt id="Rescheduling-frozen-message"><a href="#Rescheduling-frozen-message">&quot;Rescheduling frozen message&quot;</a></dt>
<dd>

</dd>
<dt id="Deleting-frozen-message"><a href="#Deleting-frozen-message">&quot;Deleting frozen message&quot;</a></dt>
<dd>

</dd>
<dt id="Getting-frozen-message-log-file"><a href="#Getting-frozen-message-log-file">&quot;Getting frozen message log file&quot;</a></dt>
<dd>

</dd>
<dt id="Getting-frozen-message"><a href="#Getting-frozen-message">&quot;Getting frozen message&quot;</a></dt>
<dd>

</dd>
<dt id="Starting-a-queue-flush"><a href="#Starting-a-queue-flush">&quot;Starting a queue flush&quot;</a></dt>
<dd>

</dd>
<dt id="Do-nothing-command"><a href="#Do-nothing-command">&quot;Do nothing command&quot;</a></dt>
<dd>

</dd>
<dt id="Quit-the-connection"><a href="#Quit-the-connection">&quot;Quit the connection&quot;</a></dt>
<dd>

</dd>
<dt id="Do-you-want"><a href="#Do-you-want">&quot;Do you want...?&quot;</a></dt>
<dd>

</dd>
</dl>

<h2 id="Description1">Description</h2>

<p>The XMail admin server &#39;speaks&#39; a given protocol that can be used by external GUI utilities written with the more disparate scripting languages, to remote administer the mail server. The protocol is based on sending formatted command and waiting for formatted server responses and error codes. All the lines, commands, and responses are delimited by a &lt;CR&gt;&lt;LF&gt; pair. The error code string (I&#39;ll call it RESSTRING) has the given format:</p>

<pre><code> &quot;+DDDDD OK&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>if the command execution is successful while:</p>

<pre><code> &quot;-DDDDD ErrorString&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>if the command failed.</p>

<p>The &quot; character is not included in responses. DDDDD is a numeric error code while ErrorString is a description of the error. If DDDDD equals 00100, a lines list, terminated by a line with a single point (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;), follows the response.</p>

<p>The input format for commands is similar to the one used in TAB files:</p>

<pre><code> &quot;cmdstring&quot;[TAB]&quot;param1&quot;[TAB]...&quot;paramN&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where &#39;cmdstring&#39; is the command string identifying the action to be performed, and param1,... are the parameters of the command.</p>

<p>Immediately after the connection with XMail controller server is established the client receives a RESSTRING that is:</p>

<pre><code> +00000 &lt;TimeStamp&gt; XMail ...</code></pre>

<p>if the server is ready, while:</p>

<pre><code> -DDDDD ...</code></pre>

<p>(where DDDDDD is an error code) if not.</p>

<p>The TimeStamp string has the format:</p>

<pre><code> currtime.pid@ipaddress</code></pre>

<p>and is used in MD5 authentication procedure.</p>

<p>As the first action immediately after the connection the client must send an authentication string with this format:</p>

<pre><code> &quot;user&quot;[TAB]&quot;password&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where user must be enabled to remote admin XMail. Clear text authentication should not be used due server security. Using MD5 authentication instead, the client must perform an MD5 checksum on the string composed by (&lt;&gt; included):</p>

<pre><code> &lt;TimeStamp&gt;password</code></pre>

<p>and then send to the server:</p>

<pre><code> &quot;user&quot;[TAB]&quot;#md5chksum&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where md5chksum is the MD5 checksum (note &#39;<b>#</b>&#39; as first char of sent digest). The result of the authentication send is a RESSTRING. If the user does not receive a positive authentication response, the connection is closed by the server. It is possible to establish an SSL session with the server by issuing the &quot;#!TLS&quot; string as login string. In response to that, the server will send back a RESSTRING. In case of success RESSTRING, the client can proceed with the SSL link negotiation with the server.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-a-user1">Adding a user</h2>

<pre><code> &quot;useradd&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;[TAB]&quot;usertype&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="username">username</dt>
<dd>

<p>username to add.</p>

</dd>
<dt id="password">password</dt>
<dd>

<p>user password.</p>

</dd>
<dt id="usertype">usertype</dt>
<dd>

<p>&#39;U&#39; for normal user and &#39;M&#39; for mailing list.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-a-user1">Deleting a user</h2>

<pre><code> &quot;userdel&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain1">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="username1">username</dt>
<dd>

<p>username to delete.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Changing-a-users-password1">Changing a user&#39;s password</h2>

<pre><code> &quot;userpasswd&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain2">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="username2">username</dt>
<dd>

<p>username (must exist).</p>

</dd>
<dt id="password1">password</dt>
<dd>

<p>new password.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Authenticate-user1">Authenticate user</h2>

<pre><code> &quot;userauth&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain3">domain</dt>
<dd>

<p>domain name.</p>

</dd>
<dt id="username3">username</dt>
<dd>

<p>username.</p>

</dd>
<dt id="password2">password</dt>
<dd>

<p>password.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Retrieve-user-statistics1">Retrieve user statistics</h2>

<pre><code> &quot;userstat&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain4">domain</dt>
<dd>

<p>domain name.</p>

</dd>
<dt id="username4">username</dt>
<dd>

<p>username/alias.</p>

</dd>
</dl>

<p>The result is a RESSTRING. If successful (00100), a formatted matching users list follows terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). This is the format of the listing:</p>

<pre><code> &quot;variable&quot;[TAB]&quot;value&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>Where valid variables are:</p>

<dl>

<dt id="RealAddress">RealAddress</dt>
<dd>

<p>real address (maybe different is the supplied username is an alias).</p>

</dd>
<dt id="MailboxSize">MailboxSize</dt>
<dd>

<p>total size of the mailbox in bytes.</p>

</dd>
<dt id="MailboxMessages">MailboxMessages</dt>
<dd>

<p>total number of messages.</p>

</dd>
<dt id="LastLoginIP">LastLoginIP</dt>
<dd>

<p>last user login IP address.</p>

</dd>
<dt id="LastLoginTimeDate">LastLoginTimeDate</dt>
<dd>

<p>time of the last login.</p>

</dd>
</dl>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-an-alias1">Adding an alias</h2>

<pre><code> &quot;aliasadd&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;account&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain5">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="alias">alias</dt>
<dd>

<p>alias to add.</p>

</dd>
<dt id="account">account</dt>
<dd>

<p>real email account (locally handled). This can be a fully qualified email address or a username inside the same domain.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-an-alias1">Deleting an alias</h2>

<pre><code> &quot;aliasdel&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain6">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="alias1">alias</dt>
<dd>

<p>alias to delete.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-aliases1">Listing aliases</h2>

<pre><code> &quot;aliaslist&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;account&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;aliaslist&quot;[TAB]&quot;domain&quot;[TAB]&quot;alias&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;aliaslist&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;aliaslist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain7">domain</dt>
<dd>

<p>domain name, optional (can contain wild cards).</p>

</dd>
<dt id="alias2">alias</dt>
<dd>

<p>alias name, optional (can contain wildcards).</p>

</dd>
<dt id="account1">account</dt>
<dd>

<p>account, optional (can contain wildcards).</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;aliaslist&quot;[TAB]&quot;foo.bar&quot;[TAB]&quot;*&quot;[TAB]&quot;mickey&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>lists all aliases of user &#39;<b>mickey</b>&#39; in domain &#39;<b>foo.bar</b>&#39;.</p>

<p>The result is a RESSTRING. In successful cases (00100) a formatted matching users list follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). This is the format of the listing:</p>

<pre><code> &quot;domain&quot;[TAB]&quot;alias&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-an-external-alias">Adding an external alias</h2>

<pre><code> &quot;exaliasadd&quot;[TAB]&quot;local-address&quot;[TAB]&quot;remote-address&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="local-address">local-address</dt>
<dd>

<p>local email address.</p>

</dd>
<dt id="remote-address">remote-address</dt>
<dd>

<p>remote email address.</p>

</dd>
</dl>

<p>For example, the following command string:</p>

<pre><code> &quot;exaliasadd&quot;[TAB]&quot;dlibenzi@home.bogus&quot;[TAB]&quot;dlibenzi@xmailserver.org&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>will link the external email address &#39;<b>dlibenzi@xmailserver.org</b>&#39; with the local email address &#39;<b>dlibenzi@home.bogus</b>&#39;. The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-an-external-alias">Deleting an external alias</h2>

<pre><code> &quot;exaliasdel&quot;[TAB]&quot;remote-address&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="remote-address1">remote-address</dt>
<dd>

<p>remote email address.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-external-aliases">Listing external aliases</h2>

<pre><code> &quot;exaliaslist&quot;[TAB]&quot;local-address&quot;[TAB]&quot;remote-address&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;exaliaslist&quot;[TAB]&quot;local-address&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;exaliaslist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="local-address1">local-address</dt>
<dd>

<p>local email address. This can contain wildcard characters.</p>

</dd>
<dt id="remote-address2">remote-address</dt>
<dd>

<p>remote email address. This can contain wildcard characters.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;exaliaslist&quot;[TAB]&quot;*@home.bogus&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>lists all the external aliases linked to local accounts in domain &#39;<b>home.bogus</b>&#39;.</p>

<p>The result is a RESSTRING. In successful cases (00100) a formatted matching users list follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). This is the format of the listing:</p>

<pre><code> &quot;rmt-domain&quot;[TAB]&quot;rmt-name&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-name&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-user-vars1">Listing user vars</h2>

<pre><code> &quot;uservars&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain8">domain</dt>
<dd>

<p>domain name.</p>

</dd>
<dt id="username5">username</dt>
<dd>

<p>username.</p>

</dd>
</dl>

<p>The result is a RESSTRING. In successfully cases (00100) a formatted list of user vars follow, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). This is the format of the listing:</p>

<pre><code> &quot;varname&quot;[TAB]&quot;varvalue&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Setting-user-vars1">Setting user vars</h2>

<pre><code> &quot;uservarsset&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;varname&quot;[TAB]&quot;varvalue&quot; ... &lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain9">domain</dt>
<dd>

<p>domain name.</p>

</dd>
<dt id="username6">username</dt>
<dd>

<p>username.</p>

</dd>
<dt id="varname">varname</dt>
<dd>

<p>variable name.</p>

</dd>
<dt id="varvalue">varvalue</dt>
<dd>

<p>variable value.</p>

</dd>
</dl>

<p>There can be multiple variable assignments with a single call. If &#39;<b>varvalue</b>&#39; is the string &#39;<b>.|rm</b>&#39; the variable &#39;<b>varname</b>&#39; is deleted. The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-users1">Listing users</h2>

<pre><code> &quot;userlist&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;userlist&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;userlist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain10">domain</dt>
<dd>

<p>domain name, optional (can contain wild cards).</p>

</dd>
<dt id="username7">username</dt>
<dd>

<p>username, optional (can contain wild cards).</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;userlist&quot;[TAB]&quot;spacejam.foo&quot;[TAB]&quot;*admin&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>lists all users of domain &#39;<b>spacejam.foo</b>&#39; that end with the word &#39;<b>admin</b>&#39;.</p>

<p>The result are a RESSTRING. If successful (00100), a formatted matching users list follows terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). This is the format of the listing:</p>

<pre><code> &quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;password&quot;[TAB]&quot;usertype&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Getting-mailproc.tab-file1">Getting mailproc.tab file</h2>

<pre><code> &quot;usergetmproc&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;usergetmproc&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;flags&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain11">domain</dt>
<dd>

<p>domain name.</p>

</dd>
<dt id="username8">username</dt>
<dd>

<p>username.</p>

</dd>
<dt id="flags">flags</dt>
<dd>

<p>flags specifying which mailproc to retrieve. Use &#39;U&#39; for user mailproc, or &#39;D&#39; for domain mailproc (or &#39;DU&#39; for a merge of both). If not specified, &#39;DU&#39; is assumed.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;usergetmproc&quot;[TAB]&quot;spacejam.foo&quot;[TAB]&quot;admin&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>gets mailproc.tab file for user &#39;<b>admin</b>&#39; in domain &#39;<b>spacejam.foo</b>&#39;.</p>

<p>The result is a RESSTRING. In successful cases (00100) the mailproc.tab file is listed line by line, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Setting-mailproc.tab-file1">Setting mailproc.tab file</h2>

<pre><code> &quot;usersetmproc&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;usersetmproc&quot;[TAB]&quot;domain&quot;[TAB]&quot;username&quot;[TAB]&quot;which&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain12">domain</dt>
<dd>

<p>domain name.</p>

</dd>
<dt id="username9">username</dt>
<dd>

<p>username.</p>

</dd>
<dt id="which">which</dt>
<dd>

<p>which mailproc.tab should be set. Use &#39;U&#39; for the user one, and &#39;D&#39; for the domain one. If not specified, &#39;U&#39; is assumed.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;usersetmproc&quot;[TAB]&quot;spacejam.foo&quot;[TAB]&quot;admin&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>sets mailproc.tab file for user &#39;<b>admin</b>&#39; in domain &#39;<b>spacejam.foo</b>&#39;.</p>

<p>The result is a RESSTRING. If successful (00101), the client must list the mailproc.tab file line by line, ending with a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). If a line of the file begins with a dot, another dot must be added at the beginning of the line. If the file has zero length the mailproc.tab is deleted. The client then gets another RESSTRING indicating the final command result.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-a-mailing-list-user1">Adding a mailing list user</h2>

<pre><code> &quot;mluseradd&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;[TAB]&quot;mailaddress&quot;[TAB]&quot;perms&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;mluseradd&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;[TAB]&quot;mailaddress&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain13">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="mlusername">mlusername</dt>
<dd>

<p>mailing list username.</p>

</dd>
<dt id="mailaddress">mailaddress</dt>
<dd>

<p>mail address to add to the mailing list &#39;mlusername@domain&#39;.</p>

</dd>
<dt id="perms1">perms</dt>
<dd>

<p>user permissions (R or RW or RA). When &#39;<b>perms</b>&#39; is not specified the default is RW.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-a-mailing-list-user1">Deleting a mailing list user</h2>

<pre><code> &quot;mluserdel&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;[TAB]&quot;mailaddress&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain14">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="mlusername1">mlusername</dt>
<dd>

<p>mailing list username.</p>

</dd>
<dt id="mailaddress1">mailaddress</dt>
<dd>

<p>mail address to delete from the mailing list &#39;mlusername@domain&#39;.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-mailing-list-users1">Listing mailing list users</h2>

<pre><code> &quot;mluserlist&quot;[TAB]&quot;domain&quot;[TAB]&quot;mlusername&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain15">domain</dt>
<dd>

<p>domain name (must be handled by the server).</p>

</dd>
<dt id="mlusername2">mlusername</dt>
<dd>

<p>mailing list username.</p>

</dd>
</dl>

<p>The result is a RESSTRING. If successful (00100), a formatted list of mailing list users follows terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-a-domain1">Adding a domain</h2>

<pre><code> &quot;domainadd&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain16">domain</dt>
<dd>

<p>domain name to add.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-a-domain1">Deleting a domain</h2>

<pre><code> &quot;domaindel&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain17">domain</dt>
<dd>

<p>domain name to delete.</p>

</dd>
</dl>

<p>The result is a RESSTRING. This is not always a safe operation.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-handled-domains1">Listing handled domains</h2>

<pre><code> &quot;domainlist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or:</p>

<pre><code> &quot;domainlist&quot;[TAB]&quot;wildmatch0&quot;[TAB]...[TAB]&quot;wildmatchN&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. The wild match versions simply returns a filtered list of domains. If successful (00100), a formatted list of handled domains follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-a-domain-alias1">Adding a domain alias</h2>

<pre><code> &quot;aliasdomainadd&quot;[TAB]&quot;realdomain&quot;[TAB]&quot;aliasdomain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>Example:</p>

<pre><code> &quot;aliasdomainadd&quot;[TAB]&quot;xmailserver.org&quot;[TAB]&quot;xmailserver.com&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>defines &#39;<b>xmailserver.com</b>&#39; as an alias of &#39;<b>xmailserver.org</b>&#39;, or:</p>

<pre><code> &quot;aliasdomainadd&quot;[TAB]&quot;xmailserver.org&quot;[TAB]&quot;*.xmailserver.org&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>defines all subdomains of &#39;<b>xmailserver.org</b>&#39; as aliases of &#39;<b>xmailserver.org</b>&#39;.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-a-domain-alias1">Deleting a domain alias</h2>

<pre><code> &quot;aliasdomaindel&quot;[TAB]&quot;aliasdomain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>Example:</p>

<pre><code> &quot;aliasdomaindel&quot;[TAB]&quot;*.xmailserver.org&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>removes the &#39;<b>*.xmailserver.org</b>&#39; domain alias.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-alias-domains1">Listing alias domains</h2>

<pre><code> &quot;aliasdomainlist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or:</p>

<pre><code> &quot;aliasdomainlist&quot;[TAB]&quot;wild-dom-match&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or:</p>

<pre><code> &quot;aliasdomainlist&quot;[TAB]&quot;wild-dom-match&quot;[TAB]&quot;wild-adom-match&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. The wild match version simply returns a filtered list of alias domains. If successful (00100), a formatted list of alias domains follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). The output format is:</p>

<pre><code> &quot;real-domain&quot;[TAB]&quot;alias-domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Getting-custom-domain-file1">Getting custom domain file</h2>

<pre><code> &quot;custdomget&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain18">domain</dt>
<dd>

<p>domain name.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;custdomget&quot;[TAB]&quot;spacejam.foo&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>gets the custom domain file for domain &#39;<b>spacejam.foo</b>&#39;.</p>

<p>The result is a RESSTRING. If successful (00100), the custom domain file is listed line by line terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Setting-custom-domain-file1">Setting custom domain file</h2>

<pre><code> &quot;custdomset&quot;[TAB]&quot;domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="domain19">domain</dt>
<dd>

<p>domain name.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;custdomset&quot;[TAB]&quot;spacejam.foo&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>sets custom domain file for domain &#39;<b>spacejam.foo</b>&#39;.</p>

<p>The result is a RESSTRING. If successful (00101), the client must list the custom domain file line by line, ending with a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). If a line of the file begins with a dot, another dot must be added at the begin of the line. If the file has zero length the custom domain file is deleted. The client then gets another RESSTRING indicating the final command result.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-custom-domains1">Listing custom domains</h2>

<pre><code> &quot;custdomlist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. If successful (00100), a formatted list of custom domains follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Adding-a-POP3-external-link1">Adding a POP3 external link</h2>

<pre><code> &quot;poplnkadd&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;[TAB]&quot;extrn-domain&quot;=&gt;
   [TAB]&quot;extrn-username&quot;[TAB]&quot;extrn-password&quot;[TAB]&quot;authtype&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="loc-domain">loc-domain</dt>
<dd>

<p>local domain name (must be handled by the server).</p>

</dd>
<dt id="loc-username">loc-username</dt>
<dd>

<p>local username which receives mails.</p>

</dd>
<dt id="extrn-domain">extrn-domain</dt>
<dd>

<p>external domain.</p>

</dd>
<dt id="extrn-username">extrn-username</dt>
<dd>

<p>external username.</p>

</dd>
<dt id="extrn-password">extrn-password</dt>
<dd>

<p>external user password.</p>

</dd>
<dt id="authtype">authtype</dt>
<dd>

<p>authentication method (see [<a href="#POP3LINKS.TAB">POP3LINKS.TAB</a>]).</p>

</dd>
</dl>

<p>The remote server must support &#39;<b>APOP</b>&#39; authentication to specify APOP as authtype. Using APOP authentication is more secure because clear usernames and passwords do not travel on the network; if you&#39;re not sure about it, specify &#39;<b>CLR</b>&#39; as authtype.</p>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-a-POP3-external-link1">Deleting a POP3 external link</h2>

<pre><code> &quot;poplnkdel&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;[TAB]&quot;extrn-domain&quot;=&gt;
   [TAB]&quot;extrn-username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="loc-domain1">loc-domain</dt>
<dd>

<p>local domain name (must be handled by the server).</p>

</dd>
<dt id="loc-username1">loc-username</dt>
<dd>

<p>local username which receives mails.</p>

</dd>
<dt id="extrn-domain1">extrn-domain</dt>
<dd>

<p>external domain.</p>

</dd>
<dt id="extrn-username1">extrn-username</dt>
<dd>

<p>external username.</p>

</dd>
</dl>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-POP3-external-links1">Listing POP3 external links</h2>

<pre><code> &quot;poplnklist&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;poplnklist&quot;[TAB]&quot;loc-domain&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;poplnklist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. If successful (00100), a formatted list of handled domains follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). The format of the listing is:</p>

<pre><code> &quot;loc-domain&quot;[TAB]&quot;loc-username&quot;[TAB]&quot;extrn-domain&quot;[TAB]&quot;extrn-username&quot;=&gt;
   [TAB]&quot;extrn-password&quot;[TAB]&quot;authtype&quot;[TAB]&quot;on-off&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Enabling-a-POP3-external-link1">Enabling a POP3 external link</h2>

<pre><code> &quot;poplnkenable&quot;[TAB]&quot;enable&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;=&gt;
   [TAB]&quot;extrn-domain&quot;[TAB]&quot;extrn-username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>or</p>

<pre><code> &quot;poplnkenable&quot;[TAB]&quot;enable&quot;[TAB]&quot;loc-domain&quot;[TAB]&quot;loc-username&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="enable">enable</dt>
<dd>

<p>1 for enabling - 0 for disabling.</p>

</dd>
<dt id="loc-domain2">loc-domain</dt>
<dd>

<p>local domain name.</p>

</dd>
<dt id="loc-username2">loc-username</dt>
<dd>

<p>local username which receives mails.</p>

</dd>
<dt id="extrn-domain2">extrn-domain</dt>
<dd>

<p>external domain.</p>

</dd>
<dt id="extrn-username2">extrn-username</dt>
<dd>

<p>external username.</p>

</dd>
</dl>

<p>In the second format all users, links are affected by the enable operation.</p>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-files1">Listing files</h2>

<pre><code> &quot;filelist&quot;[TAB]&quot;relative-dir-path&quot;[TAB]&quot;match-string&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="relative-dir-path">relative-dir-path</dt>
<dd>

<p>path relative to MAIL_ROOT path.</p>

</dd>
<dt id="match-string">match-string</dt>
<dd>

<p>wild card match string for file list selection.</p>

</dd>
</dl>

<p>The result is a RESSTRING. If successful (00100), the directory is listed line by line, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). The listing format is:</p>

<p>&quot;filename&quot;[TAB]&quot;filesize&quot;&lt;CR&gt;&lt;LF&gt;</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Getting-configuration-file1">Getting configuration file</h2>

<pre><code> &quot;cfgfileget&quot;[TAB]&quot;relative-file-path&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="relative-file-path">relative-file-path</dt>
<dd>

<p>path relative to MAIL_ROOT path.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;cfgfileget&quot;[TAB]&quot;ctrlaccounts.tab&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. If successful (00100), the file is listed line by line, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). You CANNOT use this command with indexed files !</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Setting-configuration-file1">Setting configuration file</h2>

<pre><code> &quot;cfgfileset&quot;[TAB]&quot;relative-file-path&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="relative-file-path1">relative-file-path</dt>
<dd>

<p>path relative to MAIL_ROOT path.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;cfgfileset&quot;[TAB]&quot;ctrlaccounts.tab&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. IF successful (00101), the client must list the configuration file line by line, ending with a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). If a line of the file begins with a dot, another dot must be added at the beginning of the line. If the file has zero length the configuration file is deleted. The client then gets another RESSTRING indicating the final command result. Remember that configuration files have a strict syntax and that pushing a incorrect one can make XMail not work properly. You CANNOT use this command with indexed files!</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Listing-frozen-messages1">Listing frozen messages</h2>

<pre><code> &quot;frozlist&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING. If successful (00100), a formatted list of frozen messages follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;). The format of the listing is:</p>

<pre><code> &quot;msgfile&quot;[tab]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;from&quot;[TAB]&quot;to&quot;[TAB]&quot;time&quot;[TAB]&quot;size&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>Where:</p>

<dl>

<dt id="msgfile">msgfile</dt>
<dd>

<p>message name or id.</p>

</dd>
<dt id="lev0">lev0</dt>
<dd>

<p>queue fs level 0 (first level directory index).</p>

</dd>
<dt id="lev1">lev1</dt>
<dd>

<p>queue fs level 1 (second level directory index).</p>

</dd>
<dt id="from">from</dt>
<dd>

<p>message sender.</p>

</dd>
<dt id="to">to</dt>
<dd>

<p>message destination.</p>

</dd>
<dt id="time">time</dt>
<dd>

<p>message time (&quot;YYYY-MM-DD HH:MM:SS&quot;).</p>

</dd>
<dt id="size">size</dt>
<dd>

<p>message size in bytes.</p>

</dd>
</dl>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Rescheduling-frozen-message1">Rescheduling frozen message</h2>

<pre><code> &quot;frozsubmit&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="msgfile1">msgfile</dt>
<dd>

<p>message name or id.</p>

</dd>
<dt id="lev01">lev0</dt>
<dd>

<p>queue fs level 0 (first level directory index).</p>

</dd>
<dt id="lev11">lev1</dt>
<dd>

<p>queue fs level 1 (second level directory index).</p>

</dd>
</dl>

<p>You can get this information from the <a href="#Listing-frozen-messages">frozlist</a> command. After a message has been successfully rescheduled it is deleted from the frozen fs path. The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Deleting-frozen-message1">Deleting frozen message</h2>

<pre><code> &quot;frozdel&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="msgfile2">msgfile</dt>
<dd>

<p>message name or id.</p>

</dd>
<dt id="lev02">lev0</dt>
<dd>

<p>queue fs level 0 (first level directory index).</p>

</dd>
<dt id="lev12">lev1</dt>
<dd>

<p>queue fs level 1 (second level directory index).</p>

</dd>
</dl>

<p>You can get this information from the <a href="#Listing-frozen-messages">frozlist</a> command. The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Getting-frozen-message-log-file1">Getting frozen message log file</h2>

<pre><code> &quot;frozgetlog&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="msgfile3">msgfile</dt>
<dd>

<p>message name or id.</p>

</dd>
<dt id="lev03">lev0</dt>
<dd>

<p>queue fs level 0 (first level directory index).</p>

</dd>
<dt id="lev13">lev1</dt>
<dd>

<p>queue fs level 1 (second level directory index).</p>

</dd>
</dl>

<p>You can get this information from the <a href="#Listing-frozen-messages">frozlist</a> command. The result is a RESSTRING. If successful (00100), the frozen message log file follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Getting-frozen-message1">Getting frozen message</h2>

<pre><code> &quot;frozgetmsg&quot;[TAB]&quot;lev0&quot;[TAB]&quot;lev1&quot;[TAB]&quot;msgfile&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="msgfile4">msgfile</dt>
<dd>

<p>message name or id.</p>

</dd>
<dt id="lev04">lev0</dt>
<dd>

<p>queue fs level 0 (first level directory index).</p>

</dd>
<dt id="lev14">lev1</dt>
<dd>

<p>queue fs level 1 (second level directory index).</p>

</dd>
</dl>

<p>You can get this information from the <a href="#Listing-frozen-messages">frozlist</a> command. The result is a RESSTRING. If successful (00100), the frozen message file follows, terminated by a line containing a single dot (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;).</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Starting-a-queue-flush1">Starting a queue flush</h2>

<pre><code> &quot;etrn&quot;[TAB]&quot;email-match0&quot;...&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>where:</p>

<dl>

<dt id="email-match0">email-match0</dt>
<dd>

<p>wild card email matching for destination address.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> &quot;etrn&quot;  &quot;*@*.mydomain.com&quot;  &quot;your-domain.org&quot;</code></pre>

<p>starts queueing all messages with a matching destination address.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Do-nothing-command1">Do nothing command</h2>

<p>&quot;noop&quot;&lt;CR&gt;&lt;LF&gt;</p>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Quit-the-connection1">Quit the connection</h2>

<pre><code> &quot;quit&quot;&lt;CR&gt;&lt;LF&gt;</code></pre>

<p>The result is a RESSTRING.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h2 id="Do-you-want1">Do you want...?</h2>

<p>Do you want to build GUI configuration tools using common scripting languages (Java, TCL/Tk, etc) and XMail controller protocol? Do you want to build Web configuration tools? Please let me know &lt;davidel@xmailserver.org&gt;.</p>

<p>[<a href="#XMail-admin-protocol">admin protocol</a>] [<a href="#index__">top</a>]</p>

<h1 id="XMAIL-LOCAL-MAILER">XMAIL LOCAL MAILER</h1>

<p>XMail has the ability to deliver locally prepared mail files that if finds in the &#39;<b>spool/local</b>&#39; directory. The format of these files is strict:</p>

<pre><code> mail from:&lt;...&gt;[CR][LF]
 rcpt to:&lt;...&gt;[CR][LF]
 ...
 [CR][LF]
 message text in RFC822 format with [CR][LF] line termination</code></pre>

<p>All lines must be [CR][LF] terminated, with one mail-from statement, one or more rcpt-to statements, an empty line and the message text. Mail files must not be created directly inside the &#39;<b>/spool/local</b>&#39; directory but instead inside &#39;<b>/spool/temp</b>&#39; directory. When the file is prepared it has to be moved into &#39;<b>/spool/local</b>&#39;. The file name format is:</p>

<pre><code> stime-seqnr.pid.hostname</code></pre>

<p>where:</p>

<dl>

<dt id="stime">stime</dt>
<dd>

<p>system time in sec from 01/01/1970.</p>

</dd>
<dt id="seqnr">seqnr</dt>
<dd>

<p>sequence number for the current file.</p>

</dd>
<dt id="pid">pid</dt>
<dd>

<p>process or thread id.</p>

</dd>
<dt id="hostname">hostname</dt>
<dd>

<p>creator process host name.</p>

</dd>
</dl>

<p>Example:</p>

<pre><code> 97456928-001.7892.home.bogus</code></pre>

<p>XMail has a number of LMAIL threads that periodically scan the &#39;<b>/spool/local</b>&#39; directory watching for locally generated mail files. You can tune this number of threads with the &#39;<b>-Ln nthreads</b>&#39; command line option. The suggested number ranges from three to seven.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="CtrlClnt-XMAIL-ADMINISTRATION">CtrlClnt (XMAIL ADMINISTRATION)</h1>

<p>You can use CtrlClnt to send administration commands to XMail. These commands are defined in the previous section (<a href="#XMAIL-ADMIN-PROTOCOL">&quot;XMAIL ADMIN PROTOCOL&quot;</a>). The syntax of CtrlClnt is:</p>

<pre><code> CtrlClnt  [-snuptfSLcKCXHD]  ...</code></pre>

<p>where:</p>

<dl>

<dt id="s-server">-s server</dt>
<dd>

<p>set server address.</p>

</dd>
<dt id="n-port">-n port</dt>
<dd>

<p>set server port [6017].</p>

</dd>
<dt id="u-user">-u user</dt>
<dd>

<p>set username.</p>

</dd>
<dt id="p-pass">-p pass</dt>
<dd>

<p>set password.</p>

</dd>
<dt id="t-timeout">-t timeout</dt>
<dd>

<p>set timeout [60].</p>

</dd>
<dt id="f-filename">-f filename</dt>
<dd>

<p>set dump filename [stdout].</p>

</dd>
<dt id="S4">-S</dt>
<dd>

<p>enable SSL link negotiation (talks to a CTRL port)</p>

</dd>
<dt id="L">-L</dt>
<dd>

<p>use native SSL link (talks to a CTRLS port)</p>

</dd>
<dt id="K-filename">-K filename</dt>
<dd>

<p>set the SSL private key file (the environment variable &quot;CTRL_KEY_FILE&quot; also sets it)</p>

</dd>
<dt id="C-filename">-C filename</dt>
<dd>

<p>set the SSL certificate file (the environment variable &quot;CTRL_CERT_FILE&quot; also sets it)</p>

</dd>
<dt id="X-filename">-X filename</dt>
<dd>

<p>set the SSL certificate-list file (the environment variable &quot;CTRL_CA_FILE&quot; also sets it). See [<a href="#SSL-CONFIGURATION">SSL CONFIGURATION</a>] for more information</p>

</dd>
<dt id="H-dir">-H dir</dt>
<dd>

<p>set the SSL certificate-store directory (the environment variable &quot;CTRL_CA_PATH&quot; also sets it). See [<a href="#SSL-CONFIGURATION">SSL CONFIGURATION</a>] for more information</p>

</dd>
<dt id="D">-D</dt>
<dd>

<p>enable debug output</p>

</dd>
</dl>

<p>With the command and parameters that follow adhering to the command syntax, i.e.:</p>

<pre><code> CtrlClnt  -s mail.foo.org -u davide.libenzi -p ciao=&gt;
   useradd home.bogus foouser foopasswd U</code></pre>

<p>executes the command useradd with parameters &#39;<b>home.bogus foouser foopasswd U</b>&#39;.</p>

<p>CtrlClnt returns 0 if the command is successful and != 0 if not. If the command is a query, then the result is printed to stdout.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="SERVER-SHUTDOWN">SERVER SHUTDOWN</h1>

<dl>

<dt id="Linux">[Linux]</dt>
<dd>

<p>Under Linux, XMail creates a file named XMail.pid in &#39;<b>/var/run</b>&#39; that contains the PID of the main XMail thread. By issuing a:</p>

<pre><code> kill -INT `cat /var/run/XMail.pid`</code></pre>

<p>a system administrator can initiate the shutdown process (this can take several seconds). You can use the supplied &#39;<b>xmail</b>&#39; startup script to start / stop / restart XMail:</p>

<pre><code> xmail start / stop / restart</code></pre>

</dd>
<dt id="NT-as-console-service">[NT as console service]</dt>
<dd>

<p>Under NT console service (XMail --debug ...) you can hit Ctrl-C to initiate the shutdown process.</p>

</dd>
<dt id="NT-as-service">[NT as service]</dt>
<dd>

<p>Using [Control Panel]-&gt;[Services] you can start and stop XMail as you wish.</p>

</dd>
<dt id="All">[All]</dt>
<dd>

<p>XMail detects a shutdown condition by checking the presence of a file named &#39;<b>.shutdown</b>&#39; in its main directory (MAIL_ROOT). You can initiate XMail shutdown process by creating (or copying) a file with that name into MAIL_ROOT.</p>

</dd>
</dl>

<p>[<a href="#index__">top</a>]</p>

<h1 id="MkUsers">MkUsers</h1>

<p>This command line utility enables you to create the user accounts structure by giving it a formatted list of users parameters (or a formatted text file). The syntax of the list (or file) is:</p>

<pre><code> domain;username;password;real-name;homepage[NEWLINE]</code></pre>

<p>where a line whose first character is &#39;<b>#</b>&#39; is treated as a comment. This utility can also be used to create a random number users (useful for me to test server performance).</p>

<p>These are MkUsers command line parameters:</p>

<dl>

<dt id="a-numusers">-a numusers</dt>
<dd>

<p>number of users to create in auto-mode.</p>

</dd>
<dt id="d-domain">-d domain</dt>
<dd>

<p>domain name in auto-mode.</p>

</dd>
<dt id="f-inputFile">-f inputFile</dt>
<dd>

<p>input file name {stdin}.</p>

</dd>
<dt id="u-username">-u username</dt>
<dd>

<p>radix user name in auto-mode.</p>

</dd>
<dt id="r-rootdir">-r rootdir</dt>
<dd>

<p>mail root path {./}.</p>

</dd>
<dt id="s-mboxsize">-s mboxsize</dt>
<dd>

<p>mailbox maximum size {10000}.</p>

</dd>
<dt id="i-useridbase">-i useridbase</dt>
<dd>

<p>base user id {1};</p>

</dd>
<dt id="m">-m</dt>
<dd>

<p>create Maildir boxes.</p>

</dd>
<dt id="h">-h</dt>
<dd>

<p>show this message.</p>

</dd>
</dl>

<p>MkUsers creates, under the specified root directory, the given structure:</p>

<pre><code> rootdir            &lt;dir&gt;
   mailusers.tab    &lt;file&gt;
   domains          &lt;dir&gt;
     domainXXX      &lt;dir&gt;
       userXXX      &lt;dir&gt;
         user.tab   &lt;file&gt;
         mailbox    &lt;dir&gt;
       ...
    ...</code></pre>

<p>for the mailbox structure, while:</p>

<pre><code> rootdir            &lt;dir&gt;
   mailusers.tab    &lt;file&gt;
   domains          &lt;dir&gt;
     domainXXX      &lt;dir&gt;
       userXXX      &lt;dir&gt;
         user.tab   &lt;file&gt;
         Maildir    &lt;dir&gt;
           tmp      &lt;dir&gt;
           new      &lt;dir&gt;
           cur      &lt;dir&gt;
       ...
     ...</code></pre>

<p>for the Maildir structure.</p>

<p>If the file &#39;<b>mailusers.tab</b>&#39; already exist in the mail root path, MkUsers exits without overwriting the existing copy. This protect you from accidentally overwriting your file when playing inside the real MAIL_ROOT directory. If you want to setup the root directory (-r ...) as MAIL_ROOT, you must delete by hand the existing file (you must know what you&#39;re doing). If you setup the root directory (-r ...) as MAIL_ROOT you MUST have XMail stopped before running MkUsers. Existing files and directories are not overwritten by MkUsers so you can keep your users db in the formatted text file (or generate it by a database dump for example) and run MkUsers to create the structure. Remember that you have to add new domains in the &#39;<b>domains.tab</b>&#39; file by hand. MkUsers is intended as a bulk-mode utility, not to create single user; for this CtrlClnt (or other GUI/Web configuration utilities) is better suited.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="sendmail">sendmail</h1>

<p>When building XMail, an executable called &#39;<b>sendmail</b>&#39; is created. This is a replacement of the sendmail program used mostly on Unix systems; it uses the local mail delivery of XMail to send email generated onto the server machine. These sendmail options are supported (other options are simply ignored):</p>

<dl>

<dt id="f-mail-from">-f{mail from}</dt>
<dd>

<p>Set the sender of the email.</p>

</dd>
<dt id="F-ext-mail-from">-F{ext mail from}</dt>
<dd>

<p>Set the extended sender of the email.</p>

</dd>
<dt id="t">-t</dt>
<dd>

<p>Extract recipients from the &#39;To:&#39;/&#39;Cc:&#39;/&#39;Bcc:&#39; header tags.</p>

</dd>
<dt id="i">-i</dt>
<dd>

<p>Read the input until the End Of Stream, instead of stopping at the &quot;\n.\n&quot; sequence.</p>

</dd>
</dl>

<p>The syntax is:</p>

<pre><code> sendmail [-t] [-f...] [-F...] [--input-file fname] [--xinput-file fname]=&gt;
   [--rcpt-file fname] [--] recipient ...</code></pre>

<p>The message content is read from the standard input and must be RFC compliant.</p>

<p>The following parameters are XMail extensions meant to be used with mailing lists managers (using sendmail as a mail list exploder):</p>

<dl>

<dt id="input-file-fname">--input-file fname</dt>
<dd>

<p>take the message from the specified file instead from stdin (RFC format).</p>

</dd>
<dt id="xinput-file-fname">--xinput-file fname</dt>
<dd>

<p>take the message from the specified file instead from stdin (XMail format).</p>

</dd>
<dt id="rcpt-file-fname">--rcpt-file fname</dt>
<dd>

<p>add recipients listed inside the specified file (list exploder).</p>

</dd>
</dl>

<p>To be RFC compliant means that the message MUST have the format:</p>

<pre><code> [Headers]
 NewLine
 Body</code></pre>

<p>Suppose you have your message in the file &#39;msg.txt&#39;, you&#39;re &#39;xmailuser@smartdomain&#39;, and you want to send the message to &#39;user1@dom1&#39; and &#39;user2@dom2&#39;. The syntax is:</p>

<pre><code> sendmail -fxmailuser@smartdomain user1@dom1 user2@dom2 &lt; msg.txt</code></pre>

<p>or</p>

<pre><code> sendmail -fxmailuser@smartdomain --input-file msg.txt user1@dom1 user2@dom2</code></pre>

<p>[<a href="#index__">top</a>]</p>

<h1 id="MISCELLANEOUS">MISCELLANEOUS</h1>

<ol>

<li><p>To handle multiple POP3 domains, the server makes a reverse lookup of the IP address upon which it receives the connection. Suppose the reverse lookup results in &#39;<b>xxxx.yyyy.zzzz</b>&#39;. XMail checks if &#39;<b>xxxx.yyyy.zzzz</b>&#39; is handled, then it checks &#39;<b>yyyy.zzzz</b>&#39;, and then &#39;<b>zzzz</b>&#39;. The first resolved (in the given order) is the POP3 domain. To avoid the above behavior, it&#39;s sufficient that the POP3 client supply the entire email address as POP3 login username:</p>

<pre><code> foo@foodomain.net   ==&gt; foo@foodomain.net</code></pre>

<p>and not:</p>

<pre><code> foo@foodomain.net   ==&gt; foo</code></pre>

<p>This enables XMail to handle multiple domains in cases where more nic-names are mapped over a single IP address.</p>

<p>To run finger queries you must specify:</p>

<pre><code> foo@foodomain.net@foodomain.net</code></pre>

<p>or as general rule:</p>

<pre><code> username@pop3domain@hostname</code></pre>

<p>You can use the optional configuration variable &#39;<b>POP3Domain</b>&#39; (see <a href="#SERVER.TAB-VARIABLES">&quot;SERVER.TAB VARIABLES&quot;</a> above) to set the default domain for POP3 clients connections. This means that users of &#39;<b>POP3Domain</b>&#39; can use only the name part of their email address as POP3 login, while users of other hosted domains must use their entire email as POP3 login.</p>

</li>
<li><p>Important!</p>

<ul>

<li><p>&#39;<b>REMEMBER TO REMOVE THE EXAMPLE ACCOUNT FROM CTRLACCOUNTS.TAB FILE!</b>&#39;</p>

</li>
<li><p>Use ctrl.ipmap.tab to restrict CTRL server access.</p>

</li>
<li><p>Use a long password (mixed upper/lower case with digits) for ctrlaccounts.tab.</p>

</li>
</ul>

</li>
<li><p>The main cause of bugs with XMail is due a bad line termination of configuration files, so check that these files being correctly line terminated for your OS. Linux uses the standard &lt;CR&gt; while M$ uses &lt;CR&gt;&lt;LF&gt;.</p>

</li>
<li><p>If you get a bind error in Linux,you must comment pop3, smtp and finger entries in your /etc/inetd.conf.</p>

</li>
<li><p>Remember to compile the file CTRL.IPMAP.TAB to restrict the access to the IPs you use to remote administer XMail server.</p>

</li>
<li><p>If you have an heavily loaded server remember to setup the best number of XMAIL threads by specifying the &#39;<b>-Qn nthreads</b>&#39; option (you must do some tentatives to find the best value for your needs). Also you can limit the number of SMTP, POP3 and CTRL service threads by specifying the options &#39;<b>-SX maxthreads</b>&#39;, &#39;<b>-PX maxthreads</b>&#39; and &#39;<b>-CX maxthreads</b>&#39;.</p>

</li>
<li><p>If you have enabled logging, remember to setup the &#39;<b>-Mr hours</b>&#39; option depending on the traffic you get in your server. This avoids XMail having to work with very large log files and can improve server performance.</p>

</li>
<li><p>If you are unable to start XMail (even if you followed this document&#39;s instructions), check the MailRoot directory with the one listed above. More than one unzipper does not restore empty directories by default.</p>

</li>
</ol>

<p>Please report XMail errors and errors in this document. If you successfully build and run XMail please let me know at davidel@xmailserver.org, I don&#39;t want money ;)</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="THANKS">THANKS</h1>

<p>My mother Adelisa, for giving me the light.</p>

<p>My cat Grace, for her patience waiting for food while I&#39;m coding.</p>

<p>All of the free source community, for giving me code and knowledge.</p>

<p>[<a href="#index__">top</a>]</p>

<h1 id="POD-ERRORS">POD ERRORS</h1>

<p>Hey! <b>The above document had some coding errors, which are explained below:</b></p>

<dl>

<dt id="Around-line-791">Around line 791:</dt>
<dd>

<p>=back doesn&#39;t take any parameters, but you said =back end html</p>

</dd>
<dt id="Around-line-1819">Around line 1819:</dt>
<dd>

<p>You can&#39;t have =items (as at line 1825) unless the first thing after the =over is an =item</p>

</dd>
</dl>


</body>

</html>


